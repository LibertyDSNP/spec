<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DSNP Specification</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <a href="https://www.dsnp.org/">
                    <img src="images/DSNP_Logo.png" alt="The DSNP Logo" width="123" height="55"/>
                </a>
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Introduction</a></li><li class="chapter-item affix "><a href="Roadmap.html">Roadmap</a></li><li class="chapter-item "><a href="DSNP/Overview.html">DSNP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="DSNP/Identity.html">Identity</a></li><li class="chapter-item "><a href="DSNP/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="DSNP/Graph.html">Graph</a></li><li class="chapter-item "><a href="DSNP/BatchPublications.html">Batch Publications</a></li><li class="chapter-item "><a href="DSNP/Announcements.html">Announcements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="DSNP/Types/Tombstone.html">Tombstone</a></li><li class="chapter-item "><a href="DSNP/Types/GraphChange.html">Graph Change</a></li><li class="chapter-item "><a href="DSNP/Types/Broadcast.html">Broadcast</a></li><li class="chapter-item "><a href="DSNP/Types/Reply.html">Reply</a></li><li class="chapter-item "><a href="DSNP/Types/Reaction.html">Reaction</a></li><li class="chapter-item "><a href="DSNP/Types/Profile.html">Profile</a></li><li class="chapter-item "><a href="DSNP/Types/Update.html">Update</a></li></ol></li><li class="chapter-item "><a href="DSNP/Serializations.html">Serializations</a></li></ol></li><li class="chapter-item "><a href="Implementations.html">DSNP Implementation Specs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Ethereum/Overview.html">EVM</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Ethereum/Identity.html">Identity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Ethereum/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="Ethereum/IdentityFactory.html">Factory</a></li><li class="chapter-item "><a href="Ethereum/Registry.html">Registry</a></li></ol></li><li class="chapter-item "><a href="Ethereum/Publishing.html">Publishing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Ethereum/Validation.html">Validation</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="ActivityContent/Overview.html">Activity Content</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ActivityContent/Types/Note.html">Note</a></li><li class="chapter-item "><a href="ActivityContent/Types/Profile.html">Profile</a></li><li class="chapter-item "><div>Associated Type</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ActivityContent/Associated/Hash.html">Hash</a></li><li class="chapter-item "><a href="ActivityContent/Associated/Location.html">Location</a></li><li class="chapter-item "><a href="ActivityContent/Associated/Tag.html">Tag</a></li><li class="chapter-item "><a href="ActivityContent/Associated/Attachments.html">Attachments</a></li></ol></li></ol></li><li class="chapter-item "><a href="Reference/Glossary.html">Glossary</a></li><li class="chapter-item "><div>Draft Specifications</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Draft/Archivists.html">Archivists</a></li></ol></li></ol>
                <div class="spacer"></div>
                <a href="https://www.dsnp.org/developer-portal/" class="nav-return">↩ Developer Portal</a>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DSNP Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LibertyDSNP/spec" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Type to search..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dsnp-specification"><a class="header" href="#dsnp-specification">DSNP Specification</a></h1>
<p>Welcome to the Decentralized Social Networking Protocol (DSNP) specification!
Here you can find the detailed specification documentation for DSNP, official implementation specifications, associated specifications, as well as a roadmap and proposals for future extensions.</p>
<h2 id="goals--purpose"><a class="header" href="#goals--purpose">Goals &amp; Purpose</a></h2>
<p>The free communication of users on the Internet faces a variety of problems in the modern day.
These challenges include censorship from state and corporate actors, the amplification of misinformation through viral content, and an ever-shrinking collection of near monopolies with absolute power over social interaction in the twenty-first century.
Through the DSNP, we hope to mitigate and ideally solve these challenges in the way social interaction operates online.</p>
<h2 id="how-to-read-this-specification"><a class="header" href="#how-to-read-this-specification">How to Read This Specification</a></h2>
<p>There are three core specifications currently.</p>
<table><thead><tr><th>Name</th><th>Version</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="DSNP/Overview.html">DSNP</a></td><td>1.1.0</td><td>The implementation-agnostic DSNP specification</td></tr>
<tr><td><a href="Implementations.html">DSNP Implementations</a></td><td>-</td><td>Implementation-specific specifications</td></tr>
<tr><td><a href="ActivityContent/Overview.html">Activity Content</a></td><td>1.1.0</td><td>A specification for DSNP-referenced content (subset of W3C Activity Streams)</td></tr>
</tbody></table>
<p>Each specification is divided into several modules.
Each module describes a mostly self-contained aspect of the specification.</p>
<h2 id="versioning"><a class="header" href="#versioning">Versioning</a></h2>
<p>DSNP specification versions follow <a href="https://semver.org/">Semantic Versioning 2.0</a> for releases.</p>
<h2 id="contributions"><a class="header" href="#contributions">Contributions</a></h2>
<p>Development occurs on <a href="https://github.com/LibertyDSNP/spec">GitHub</a>.
All interactions must follow the <a href="https://github.com/LibertyDSNP/spec/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a> and <a href="https://github.com/LibertyDSNP/spec/blob/main/CONTRIBUTING.md">Contribution guidelines</a>.</p>
<h2 id="draft-specifications"><a class="header" href="#draft-specifications">Draft Specifications</a></h2>
<p>Proposals for some future extensions can be found in the <a href="index.html#draft-specifications">Draft Specifications</a> section and on <a href="https://github.com/LibertyDSNP/spec/labels/enhancement">GitHub</a>; however, these proposals should be regarded with caution as they are largely incomplete and may be subject to change or deletion without notice.</p>
<table><thead><tr><th>Name</th><th>Status</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="Draft/Archivists.html">Archivist</a></td><td>DRAFT</td><td>Long-term DSNP Announcement Storage</td></tr>
</tbody></table>
<h3 id="draft-status-definitions"><a class="header" href="#draft-status-definitions">Draft Status Definitions</a></h3>
<table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>Draft</strong></td><td>Open for comment and major changes.</td></tr>
<tr><td><strong>Proposed</strong></td><td>Ready for formal review. It should be done except for minor changes.</td></tr>
<tr><td><strong>Tentative</strong></td><td>This is the accepted plan. The specification should not change unless there are blocking issues.</td></tr>
</tbody></table>
<h2 id="learning-more"><a class="header" href="#learning-more">Learning More</a></h2>
<p>In addition to this document, more resources regarding our project can be found at <a href="https://www.dsnp.org">DSNP.org</a>, including our blog, forum, code repository, and SDK.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h1>
<p><em>Last Updated: 2021-09-08</em></p>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>This document represents Roadmap for DSNP and related specifications.
Roadmap may not reflect current priorities and is subject to change.</p>
<h2 id="completed"><a class="header" href="#completed">Completed</a></h2>
<table><thead><tr><th>Work</th><th>Status</th></tr></thead><tbody>
<tr><td>Whitepaper</td><td>Done (2020 Q4)</td></tr>
<tr><td>Spec Outline</td><td>Done (2021 Q1)</td></tr>
<tr><td>Batch Announce First Draft</td><td>Done (2021 Q1)</td></tr>
<tr><td>Spec Live!</td><td>Done (2021 Q1)</td></tr>
<tr><td>Identity Contract &amp; Delegation</td><td>Done (2021 Q2)</td></tr>
<tr><td>Batch Announce File Format</td><td>Done (2021 Q3)</td></tr>
<tr><td>Identity Factory</td><td>Done (2021 Q2)</td></tr>
<tr><td>Graph Handle Registry</td><td>Done (2021 Q2)</td></tr>
<tr><td>Batch Announce Filter System</td><td>Done (2021 Q3)</td></tr>
<tr><td>Graph Data</td><td>Done (2021 Q3)</td></tr>
<tr><td>Announcement/Publishing Revision</td><td>Done (2021 Q3)</td></tr>
<tr><td>Stabilize 1.0</td><td>Done (2021 Q3)</td></tr>
</tbody></table>
<h2 id="future"><a class="header" href="#future">Future</a></h2>
<p>Below is a tentative roadmap to what protocol features are being developed next!
Items are ordered by current priority.</p>
<h3 id="chain-migration"><a class="header" href="#chain-migration">Chain Migration</a></h3>
<p><em>Status: In progress</em></p>
<p>The cost to use Ethereum is too high.
Migrate the DSNP architecture to another chain.</p>
<h3 id="private-graph"><a class="header" href="#private-graph">Private Graph</a></h3>
<p><em>Status: Whitepaper</em></p>
<p>Keep some graph connections private with permissioned access.</p>
<h3 id="direct-messaging"><a class="header" href="#direct-messaging">Direct Messaging</a></h3>
<p><em>Status: Whitepaper</em></p>
<p>One-to-one messaging with metadata privacy.</p>
<h3 id="public-friends"><a class="header" href="#public-friends">Public Friends</a></h3>
<p><em>Status: Not Started</em></p>
<p>Graph connections are currently limited to one-way follow relationships.
Build support for other forms of relationships that require all parties to opt in.</p>
<h3 id="social-account-recovery"><a class="header" href="#social-account-recovery">Social Account Recovery</a></h3>
<p><em>Status: Not Started</em></p>
<p>Use the social graph to leverage safe account recovery and protect against private key losses.</p>
<h3 id="private-friends"><a class="header" href="#private-friends">Private Friends</a></h3>
<p><em>Status: Not Started</em></p>
<p>Expand the private graph to other relationships while maintaining metadata protection.</p>
<h3 id="verified-attributes"><a class="header" href="#verified-attributes">Verified Attributes</a></h3>
<p><em>Status: Not Started</em></p>
<p>Some users and applications need social identities with additional layers of validation.
How can these be created while preserving privacy and supporting an open system?</p>
<h3 id="distributed-content-moderation"><a class="header" href="#distributed-content-moderation">Distributed Content Moderation</a></h3>
<p><em>Status: Not Started</em></p>
<p>Content moderation is hard because it means different things to different people.
Make customizing content moderation easier through distributing the work and results.</p>
<h3 id="namespace-and-multichain-support"><a class="header" href="#namespace-and-multichain-support">Namespace and Multichain Support</a></h3>
<p><em>Status: Not Started</em></p>
<p>Identity and content from other systems could be used without needing to understand the originating system.
Support DSNP across multiple chains to increase user choice and avoid locking data to one chain or network.</p>
<h3 id="content-bridges"><a class="header" href="#content-bridges">Content Bridges</a></h3>
<p><em>Status: Not Started</em></p>
<p>Open social network bridges would allow more content and users to be accessible to all via DSNP.</p>
<h3 id="service-node-protocols"><a class="header" href="#service-node-protocols">Service-Node Protocols</a></h3>
<p><em>Status: Not Started</em></p>
<p>Sub-specifications targeted at ecosystem services to promote interoperability.</p>
<h3 id="private-group-messaging"><a class="header" href="#private-group-messaging">Private Group Messaging</a></h3>
<p><em>Status: Not Started</em></p>
<p>Secure many-to-many conversations.
Group chat style with metadata privacy.</p>
<h3 id="private-posts-to-friends"><a class="header" href="#private-posts-to-friends">Private Posts to Friends</a></h3>
<p><em>Status: Not Started</em></p>
<p>Secure one-to-many posts that still allow for commenting.</p>
<h3 id="third-party-identity-bridges"><a class="header" href="#third-party-identity-bridges">Third-Party Identity Bridges</a></h3>
<p><em>Status: Not Started</em></p>
<p>Create ways for users to be able to bring their own identities or connect a DSNP Identity with outside identities.</p>
<h3 id="archivists"><a class="header" href="#archivists">Archivists</a></h3>
<p><em>Status: <a href="Draft/Archivists.html">Draft</a></em></p>
<p>Long-term storage for announcements and perhaps expanding to content storage.</p>
<h3 id="peer-to-peer-publishing"><a class="header" href="#peer-to-peer-publishing">Peer-to-Peer Publishing</a></h3>
<p><em>Status: Not Started</em></p>
<p>Build a peer-to-peer system for announcement publishing for faster routing and message delivery.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dsnp-specification-1"><a class="header" href="#dsnp-specification-1">DSNP Specification</a></h1>
<p><strong>Version 1.1.0</strong></p>
<p>DSNP is a social networking protocol designed to run on a blockchain.
It specifies a set of social primitives along with requirements for interoperability.
Go to <a href="DSNP/../Implementations.html">Implementations</a> for specifics on how DSNP is implemented on a specific blockchain.</p>
<!--- Uncomment for pre-release changes and prefix the version with `pre-[next version]`
## Prerelease Changelog

- [DIP-###](https://github.com/LibertyDSNP/spec/issues/###)

--->
<h2 id="releases"><a class="header" href="#releases">Releases</a></h2>
<p>Implementations MUST specify the version(s) of the DSNP specification with which they are compatible.</p>
<table><thead><tr><th>Version</th><th>Description</th><th>Release Date</th><th>Changelog</th></tr></thead><tbody>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/DSNP-v1.1.0">1.1.0</a></td><td>DIP-148, DIP-149, DIP-150, DIP-165, DIP-180</td><td>2022-05-06</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/DSNP-v1.1.0">Changelog</a></td></tr>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/DSNP-v1.0.0">1.0.0</a></td><td>Initial Release</td><td>2021-09-09</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/DSNP-v1.0.0">Changelog</a></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identity"><a class="header" href="#identity">Identity</a></h1>
<p>This specification is intended to cover the concept of identity within the protocol and how we represent it.</p>
<h2 id="identifiers"><a class="header" href="#identifiers">Identifiers</a></h2>
<p>DSNP <a href="DSNP/Identifiers.html">Identifiers</a> form the basis for pseudo-anonymous streams of content.
While some users may choose to link or expose their real-world identity, DSNP implementations MUST NOT require such data exposure for account creation.
The <a href="DSNP/Graph.html">social graph</a> is formed using this identifier so that a user's connections maintain integrity regardless of changes in any user's client choices or access changes.</p>
<h3 id="pseudo-anonymity"><a class="header" href="#pseudo-anonymity">Pseudo Anonymity</a></h3>
<ul>
<li>An identifier MUST default to being disconnected from a real-world identity.</li>
<li>An identifier MUST be unique to the implementation.</li>
</ul>
<h2 id="ownership"><a class="header" href="#ownership">Ownership</a></h2>
<p>A user's ownership of their identity is expressed via ownership and control of their pseudo-anonymous identifier(s).
Control entails the power to announce content associated with the identifier and
the ability to delegate permission to others to announce content on the user's behalf.</p>
<h3 id="delegation"><a class="header" href="#delegation">Delegation</a></h3>
<ul>
<li>An owner MUST be able to delegate permission to announce on their behalf to other parties.</li>
<li>A user MUST be able to revoke delegated permissions.</li>
<li>Announcements from a delegate MUST be able to be verified as to which delegate made the specific announcement.</li>
<li>Delegation revocation MUST NOT be retroactive.</li>
</ul>
<h2 id="non-normative"><a class="header" href="#non-normative">Non-normative</a></h2>
<h3 id="retroactive-revocation-of-delegation"><a class="header" href="#retroactive-revocation-of-delegation">Retroactive Revocation of Delegation</a></h3>
<p>There are many times when someone would desire retroactive revocation of delegation.
If a key was found to have been compromised at an earlier time for example.
However, retroactive revocation is much more difficult from a caching and performance perspective.
Instead <a href="DSNP/Announcements.html#reverting-an-announcement">reverting any undesirable Announcements</a> such as through <a href="DSNP/Types/Tombstone.html">Tombstones</a> allows a user to choose the specific events that need reverting and notify the network of that change.</p>
<p>To this end, any <a href="DSNP/BatchPublications.html">Batch Publications</a> can always be validated from the perspective of the time they were published instead of needing re-validation at future read times.
The validity of a Batch is thus immutable.</p>
<ol>
<li>Collect all the DSNP Ids used in a Batch.</li>
<li>Validate that each DSNP Id had delegated to the publisher of the Batch at the time of publishing.</li>
<li>Validate that any failures from step 2 were from DSNP Ids that revoked delegation within the acceptance window of prior blocks.</li>
<li>Batch can be recorded as valid or invalid.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identifiers-1"><a class="header" href="#identifiers-1">Identifiers</a></h1>
<p>The DSNP Identifiers form the basis for pseudo-anonymous streams of content.
Graph connections are formed through the DSNP User Id.</p>
<h2 id="dsnp-user-id"><a class="header" href="#dsnp-user-id">DSNP User Id</a></h2>
<ul>
<li>64-bit Unsigned Integer</li>
<li>MUST be serialized as <a href="DSNP/Serializations.html#decimal">decimal</a></li>
<li>MUST be unique per implementation</li>
</ul>
<h2 id="dsnp-content-hash"><a class="header" href="#dsnp-content-hash">DSNP Content Hash</a></h2>
<ul>
<li>MUST be 32 bytes in size</li>
<li>MUST be a <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hash</a> of the bytes of the content</li>
<li>MUST be serialized as <a href="DSNP/Serializations.html#hexadecimal">hexadecimal</a></li>
</ul>
<h3 id="dsnp-protocol-scheme"><a class="header" href="#dsnp-protocol-scheme">DSNP Protocol Scheme</a></h3>
<ul>
<li>MUST always be the string <code>dsnp://</code></li>
</ul>
<h2 id="dsnp-user-uri"><a class="header" href="#dsnp-user-uri">DSNP User URI</a></h2>
<p>DSNP User URI consists of two parts: the scheme and the user id.
It is used to identify a user via a URI.</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code>dsnp://1311768467294899700
</code></pre>
<table><thead><tr><th>part</th><th>value</th></tr></thead><tbody>
<tr><td>Scheme</td><td><code>dsnp://</code></td></tr>
<tr><td>User Id</td><td><code>1311768467294899700</code></td></tr>
</tbody></table>
<h2 id="dsnp-content-uri"><a class="header" href="#dsnp-content-uri">DSNP Content URI</a></h2>
<p>DSNP Content URI consists of three parts: the scheme, the user id, and the content hash.
It is used to uniquely identify an announcements from a given user with content.</p>
<p>Any <a href="DSNP/Announcements.html#announcement-types">Announcement Types</a> with a <code>fromId</code> and <code>contentHash</code> have a DSNP Content URI.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code>dsnp://78187493520/0x1234567890abcdef0123456789abcdef0123456789abcdef0123456789abcdef
</code></pre>
<table><thead><tr><th>part</th><th>value</th></tr></thead><tbody>
<tr><td>Scheme</td><td><code>dsnp://</code></td></tr>
<tr><td>User Id</td><td><code>78187493520</code></td></tr>
<tr><td>Content Hash</td><td><code>0x1234567890abcdef0123456789abcdef0123456789abcdef0123456789abcdef</code></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph"><a class="header" href="#graph">Graph</a></h1>
<p>This specification describes the social network graph and how it is represented in the protocol.</p>
<p>In this context a <a href="https://en.wikipedia.org/wiki/Social_graph">social graph</a> means a graph that represents social relations between entities.</p>
<p>The DSNP graph represents nodes as <a href="DSNP/Identifiers.html#dsnp-user-id">DSNP User Ids</a>.</p>
<h2 id="public-graph"><a class="header" href="#public-graph">Public Graph</a></h2>
<p>The public graph is anchored in state transitions recorded in <a href="DSNP/Types/GraphChange.html">Graph Change Announcements</a>.
Playing all state transitions in <a href="DSNP/Announcements.html#ordering-announcements">order</a> will generate the current state of the public graph.</p>
<h2 id="non-normative-1"><a class="header" href="#non-normative-1">Non-Normative</a></h2>
<h3 id="private-graph-1"><a class="header" href="#private-graph-1">Private Graph</a></h3>
<p>Future. See the <a href="https://github.com/LibertyDSNP/papers">DSNP Whitepaper</a> for foundational ideas.</p>
<h3 id="following"><a class="header" href="#following">Following</a></h3>
<p>A &quot;follow&quot; is the act of publicly following a <a href="DSNP/Identifiers.html#dsnp-user-id">DSNP User Identity</a>, which results in adding this DSNP User Id to a user's social graph.</p>
<p>An &quot;unfollow&quot; is the act of publicly unfollowing a <a href="DSNP/Identifiers.html#dsnp-user-id">DSNP User Identity</a> which results in the removal of this DSNP User Id from a user's social graph.</p>
<h3 id="friendship"><a class="header" href="#friendship">Friendship</a></h3>
<p>There is currently no concept of &quot;friendship&quot; within the DSNP network.
Friendship requires a mutual acknowledgment between two different DSNP User Identities.
Friendship could be thought of as &quot;mutual following&quot; - where two DSNP User Identities are following each other.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="batch-publications"><a class="header" href="#batch-publications">Batch Publications</a></h1>
<p>A Batch Publication is an <a href="https://github.com/apache/parquet-format">Apache Parquet</a> file with a collection of <a href="DSNP/Announcements.html">Announcements</a>.</p>
<h2 id="implementation-requirements"><a class="header" href="#implementation-requirements">Implementation Requirements</a></h2>
<h3 id="discoverable"><a class="header" href="#discoverable">Discoverable</a></h3>
<p>Implementations MUST have publicly discoverable Batch Publications.</p>
<h3 id="validity"><a class="header" href="#validity">Validity</a></h3>
<p>Implementations MUST be able to validate the Parquet file contents.
Validity MUST be immutable.</p>
<h3 id="historical"><a class="header" href="#historical">Historical</a></h3>
<p>Implementations MUST retain proof of existence of a Batch Publication.</p>
<h3 id="transparent-chain-of-delegation"><a class="header" href="#transparent-chain-of-delegation">Transparent Chain of Delegation</a></h3>
<p>All Announcements in a Batch file MUST be able to be proven to be from or have a chain of delegation to the publisher of the Batch.</p>
<h2 id="file-requirements"><a class="header" href="#file-requirements">File Requirements</a></h2>
<p>Batch files are stored and transferred in Apache Parquet format.</p>
<ul>
<li>Batch files MUST match the spec for a single <a href="DSNP/Announcements.html">Announcement Type</a>.</li>
<li>Batch files MUST have Bloom filters set in accordance with the Announcement Type Spec.</li>
<li>Batch files MUST have NO MORE THAN 128*1024 rows.</li>
</ul>
<h3 id="bloom-filter"><a class="header" href="#bloom-filter">Bloom Filter</a></h3>
<ul>
<li>A Bloom filter MUST be a <a href="https://github.com/apache/parquet-format/blob/apache-parquet-format-2.9.0/BloomFilter.md">Split Block Bloom filter</a>.</li>
<li>The false-positive rate MUST be 0.001.</li>
</ul>
<p>Calculation for filter bits is different and nearly a factor of 10 lower than for a standard Bloom filter:
128*1024 rows with a 0.001 false-positive rate results in around 29,000 bits for a Split Block Bloom filter.</p>
<p>Bloom filters are ONLY added to some fields.
See also <a href="DSNP/Announcements.html">Announcement Types</a>.</p>
<h4 id="columns-with-bloom-filters"><a class="header" href="#columns-with-bloom-filters">Columns with Bloom Filters</a></h4>
<table><thead><tr><th>Column</th><th>Parquet Type</th></tr></thead><tbody>
<tr><td>contentHash</td><td><code>BYTE_ARRAY</code></td></tr>
<tr><td>emoji</td><td><code>BYTE_ARRAY</code></td></tr>
<tr><td>fromId</td><td><code>BYTE_ARRAY</code></td></tr>
<tr><td>inReplyTo</td><td><code>BYTE_ARRAY</code></td></tr>
<tr><td>objectId</td><td><code>BYTE_ARRAY</code></td></tr>
</tbody></table>
<h2 id="non-normative-2"><a class="header" href="#non-normative-2">Non-Normative</a></h2>
<h3 id="design-requirements"><a class="header" href="#design-requirements">Design Requirements</a></h3>
<p>Batch files need to be quickly and easily searchable.
Minimal storage size and fast, simple querying are preferred over guarantees of no false positives or advanced data manipulation and column relationships.
The files are parseable by client applications, web views, or browsers running pure JavaScript without a need to convert the format.</p>
<p>Applications need to know if a given Batch file has any information they are interested in without downloading the file first.</p>
<h3 id="why-parquet"><a class="header" href="#why-parquet">Why Parquet?</a></h3>
<ol>
<li>Parquet is a <strong>column-oriented format</strong>. Since DSNP Batch Message data will have a very small column-to-row ratio compared to a typical web application database, it makes sense to prefer a column-oriented format.</li>
<li>Parquet format <strong>has been field-tested under extreme network conditions</strong>. It has broad support in cloud storage solutions, with libraries in multiple languages.</li>
<li><strong>Bloom filters are already supported</strong> in the Parquet specification, which allows for fast and accurate searching (with caveats for proper configuration).</li>
<li><strong>Amazon S3 support</strong>: We anticipate that some Batch Announcers, and possibly Archivists, will store Batch files on Amazon S3. Amazon Athena also supports storage in Parquet, and its API supports SQL-like queries.</li>
<li>Parquet also <strong>allows references to the same column across files</strong>, which could enable multi-file querying in the future.</li>
<li>Parquet <strong>supports compression formats</strong> such as Brötli, which itself is already a browser standard and has a demonstrated improvement in compression speed and file size over older formats.</li>
<li>Parquet <strong>files can be transferred directly</strong> to clients, which can parse the files in the app or browser. No conversion to some serialization format is necessary. This eliminates an entire class of bugs and makes both fetching and querying faster.</li>
<li>Parquet <strong>uses schemas</strong>, which additionally reduces file size.</li>
</ol>
<h3 id="rejected-alternatives"><a class="header" href="#rejected-alternatives">Rejected Alternatives</a></h3>
<ol>
<li>Cassandra, RocksDB, CouchDB, MongoDB, and HBASE were rejected since DSNP data needs neither a database for storage nor the overhead of one. Each of these was designed for use cases ranging from somewhat to drastically different than the DSNP network.</li>
<li>JSON, BSON, and SQLite, while used for storage sometimes, are intended for serialization. They are schemaless, which results in redundant information and therefore a larger size than formats with schemas. They also don't support Bloom filters; instead, indexing would be required, or new batches would need to be downloaded entirely.  The exception is SQLite, which does support more advanced queries; however, it was designed for in-memory storage.</li>
</ol>
<h3 id="batch-validity-and-order"><a class="header" href="#batch-validity-and-order">Batch Validity and Order</a></h3>
<p>Batch validity is immutable and usually in part based on the validation of the delegation of authors listed inside the batch to the publisher.
Due to the nature of distributed systems, it is possible that a race condition occurs such that a user's delegation revocation presents before a Batch that contains a message from that user via the revoked delegate.
While those individual messages should be considered invalid, testing a historical window of some time is suggested before considering the entire batch invalid.
This is analogous to the idea of a <a href="https://en.bitcoin.it/wiki/Confirmation">confirmation time</a>, but only applies to the past instead of the future.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="announcements-overview"><a class="header" href="#announcements-overview">Announcements Overview</a></h1>
<p>Announcements are content or references to content that communicate new user activity to the rest of the network.
Announcements are associated with an <a href="DSNP/Identifiers.html">Identifier</a> that can be validated as the creator of the announcement.
Depending on the implementation, Announcements may be published directly to the network, included in <a href="DSNP/BatchPublications.html">Batch Publication Files</a>, or some combination of those two.</p>
<h2 id="announcement-validation"><a class="header" href="#announcement-validation">Announcement Validation</a></h2>
<p>There is no guarantee that, at time of creation, a given Announcement will be from the <code>fromId</code> claimed in the Announcement.
The reader MUST perform a validation of the Announcement at read time to ensure authenticity.
Implementations MUST provide a way to validate that the <a href="DSNP/Identifiers.html">identifier</a> associated with a given <a href="DSNP/Announcements.html">Announcement</a> is authentic.</p>
<h2 id="announcement-types"><a class="header" href="#announcement-types">Announcement Types</a></h2>
<p>Each Announcement has an enumerated type for use when separating out a stream of Announcements.</p>
<table><thead><tr><th>Value</th><th>Name</th><th>Description</th><th>DSNP Content URI</th><th>Tombstone Allowed</th></tr></thead><tbody>
<tr><td>0</td><td><a href="DSNP/Types/Tombstone.html">Tombstone</a></td><td>an invalidation of previously announced content</td><td>no</td><td>no</td></tr>
<tr><td>1</td><td><a href="DSNP/Types/GraphChange.html">Graph Change</a></td><td>social graph changes</td><td>no</td><td>no</td></tr>
<tr><td>2</td><td><a href="DSNP/Types/Broadcast.html">Broadcast</a></td><td>a public post</td><td>YES</td><td>YES</td></tr>
<tr><td>3</td><td><a href="DSNP/Types/Reply.html">Reply</a></td><td>a public response to a Broadcast</td><td>YES</td><td>YES</td></tr>
<tr><td>4</td><td><a href="DSNP/Types/Reaction.html">Reaction</a></td><td>a public visual reply to a Broadcast</td><td>no</td><td>no</td></tr>
<tr><td>5</td><td><a href="DSNP/Types/Profile.html">Profile</a></td><td>a profile</td><td>YES</td><td>no</td></tr>
<tr><td>6</td><td><a href="DSNP/Types/Update.html">Update</a></td><td>an update to content</td><td>YES</td><td>no</td></tr>
</tbody></table>
<h2 id="duplicate-handling"><a class="header" href="#duplicate-handling">Duplicate Handling</a></h2>
<p>Duplicate Announcements may occur due to the nature of asynchronous communication.
In the case of duplicates, the first Announcement should be considered the ONLY valid Announcement.
Additional duplicate Announcements MUST be rejected or ignored.</p>
<h2 id="ordering-announcements"><a class="header" href="#ordering-announcements">Ordering Announcements</a></h2>
<ol>
<li>Order Batch Publications by implementation order.</li>
<li>Order Announcements in a Batch Publication File by row appearance order.</li>
</ol>
<h2 id="reverting-an-announcement"><a class="header" href="#reverting-an-announcement">Reverting an Announcement</a></h2>
<p>Announcements may not be deleted, but some may be marked as invalid by using a <a href="DSNP/Types/Tombstone.html">Tombstone Announcement</a>, or updated by using an <a href="DSNP/Types/Update.html">Update Announcement</a>.
For example, if a user creates a Reaction Announcement, they may remove that reaction by creating a Tombstone Announcement.</p>
<h2 id="non-normative-3"><a class="header" href="#non-normative-3">Non-Normative</a></h2>
<h3 id="duplicate-announcements"><a class="header" href="#duplicate-announcements">Duplicate Announcements</a></h3>
<p>Due to the distributed nature of DSNP, duplicate Announcements are possible from time to time.
These should be discarded and ignored.</p>
<h3 id="replay-attacks"><a class="header" href="#replay-attacks">Replay Attacks</a></h3>
<p>Implementations restrict replay attacks usually through testing that the chain transaction sender is authorized, often through delegation, to publish an Announcement.</p>
<h3 id="announcement-ordering-and-activity-content-published-timestamp"><a class="header" href="#announcement-ordering-and-activity-content-published-timestamp">Announcement Ordering and Activity Content Published Timestamp</a></h3>
<p>Activity Content has a published field that contains a user-generated timestamp.
User-generated timestamps cannot be validated,
but may be used to indicate ordering other than the network order for Announcements, which are <em>not</em> time dependent.</p>
<h3 id="announcement-reference-ordering"><a class="header" href="#announcement-reference-ordering">Announcement Reference Ordering</a></h3>
<p>Some Announcements contain references to other Announcements via the <code>inReplyTo</code> field.
Due to the distributed nature, the canonical order can have an Announcement that refers to another later in the order.
For display purposes, these messages should be considered to have occurred after the reference.</p>
<h3 id="dsnp-v10-announcement-signatures"><a class="header" href="#dsnp-v10-announcement-signatures">DSNP v1.0 Announcement Signatures</a></h3>
<p>In DSNP v1.0, Announcements had individual signatures.
That produced Batch Publications that were generic and disconnected from the user.
They could be submitted to the chain via anyone not just delegates or users.</p>
<p>In DSNP v1.1, Announcement signatures were removed in favor of the implementation being responsible for the connection between the on-chain signature and the user.
The expected and <a href="DSNP/../Ethereum/Validation.html">EVM implementation</a> is that the implementation chain requires that the transaction that produces a Batch be performed by the user or delegate directly.
This created batches that are delegate specific, but allows for faster testing of the validity of individual Announcements in a Batch.</p>
<p>For more information see <a href="https://github.com/LibertyDSNP/spec/issues/145">DIP-145</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tombstone-announcement"><a class="header" href="#tombstone-announcement">Tombstone Announcement</a></h1>
<p>A Tombstone Announcement is a way to note that a previously announced content is invalid and the related Announcement should be considered reverted.
It is NOT possible to revert a tombstone.</p>
<h2 id="fields"><a class="header" href="#fields">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>0</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>fromId</td><td>id of the user creating the Announcement and the Tombstoned Announcement</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>targetAnnouncementType</td><td>target tombstoned Announcement type</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>targetContentHash</td><td>target <code>contentHash</code> of the original Announcement to tombstone</td><td>32 bytes</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
</tbody></table>
<h2 id="field-requirements"><a class="header" href="#field-requirements">Field Requirements</a></h2>
<h3 id="announcementtype"><a class="header" href="#announcementtype">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>0</code></li>
</ul>
<h3 id="fromid"><a class="header" href="#fromid">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="targetannouncementtype"><a class="header" href="#targetannouncementtype">targetAnnouncementType</a></h3>
<ul>
<li>MUST be the <a href="DSNP/Types/../Announcements.html#announcement-types">Announcement Type</a> of the target Announcement</li>
<li>MUST ONLY be a Tombstone allowed Announcement Type</li>
</ul>
<h4 id="tombstone-allowed-announcement-types"><a class="header" href="#tombstone-allowed-announcement-types">Tombstone Allowed Announcement Types</a></h4>
<table><thead><tr><th>Value</th><th>Name</th></tr></thead><tbody>
<tr><td>2</td><td><a href="DSNP/Types/../Types/Broadcast.html">Broadcast</a></td></tr>
<tr><td>3</td><td><a href="DSNP/Types/../Types/Reply.html">Reply</a></td></tr>
</tbody></table>
<h3 id="targetcontenthash"><a class="header" href="#targetcontenthash">targetContentHash</a></h3>
<ul>
<li>MUST match a <code>contentHash</code> of previous Announcement with the same <code>fromId</code> as the Tombstone Announcement</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-change-announcement"><a class="header" href="#graph-change-announcement">Graph Change Announcement</a></h1>
<p>A Graph Change Announcement is for publishing relationship state changes for a user.</p>
<h2 id="fields-1"><a class="header" href="#fields-1">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>1</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>changeType</td><td>Type of relationship change</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>fromId</td><td>id of the user creating the relationship</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>objectId</td><td>id of the target of the relationship</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
</tbody></table>
<h2 id="field-requirements-1"><a class="header" href="#field-requirements-1">Field Requirements</a></h2>
<h3 id="announcementtype-1"><a class="header" href="#announcementtype-1">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>1</code></li>
</ul>
<h3 id="changetype"><a class="header" href="#changetype">changeType</a></h3>
<ul>
<li>MUST be one of the Change Type Enum</li>
</ul>
<h3 id="change-type-enum"><a class="header" href="#change-type-enum">Change Type Enum</a></h3>
<p>Different change types have different meanings.</p>
<table><thead><tr><th>Value</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>Unfollow</td><td>Remove a Follow relationship</td></tr>
<tr><td>1</td><td>Follow</td><td>Create a Follow relationship</td></tr>
</tbody></table>
<h3 id="fromid-1"><a class="header" href="#fromid-1">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="objectid"><a class="header" href="#objectid">objectId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
</ul>
<h2 id="non-normative-4"><a class="header" href="#non-normative-4">Non-Normative</a></h2>
<h3 id="graph-retrieval-ordering-and-reading"><a class="header" href="#graph-retrieval-ordering-and-reading">Graph Retrieval, Ordering and Reading</a></h3>
<p>Each Graph Change event represents a state transition for the graph.
The state of the graph at any time is given by taking the state of the graph at a previous time and applying all Graph Change events not previously applied in the order specified above.
Once those Graph Change events are retrieved, they can be ordered to reflect the current graph state
(i.e. Charlie has followed Bob, then he unfollowed him, and then followed him again. The graph state reflects that Charlie is following Bob).</p>
<p>To retrieve the graph, do the following:</p>
<ol>
<li>Retrieve the events with <a href="DSNP/Types/../Announcements.html#announcement-types">announcementType</a> matching the enum for &quot;Graph Change&quot;</li>
<li>Filter the events to a particular DSNP User Id to retrieve information about the respective graph.</li>
<li>Order the retrieved data by <a href="DSNP/Types/../Announcements.html#ordering-announcements">Announcement Ordering</a>.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="broadcast-announcement"><a class="header" href="#broadcast-announcement">Broadcast Announcement</a></h1>
<p>A Broadcast Announcement is a way to send a public message to everyone.</p>
<h2 id="fields-2"><a class="header" href="#fields-2">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>2</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>contentHash</td><td>keccak-256 hash of content stored at URL</td><td>32 bytes</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
<tr><td>fromId</td><td>id of the user creating the announcement</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>url</td><td>content URL</td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>no</td></tr>
</tbody></table>
<h2 id="field-requirements-2"><a class="header" href="#field-requirements-2">Field Requirements</a></h2>
<h3 id="announcementtype-2"><a class="header" href="#announcementtype-2">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>2</code></li>
</ul>
<h3 id="contenthash"><a class="header" href="#contenthash">contentHash</a></h3>
<ul>
<li>MUST be the <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hash</a> of the bytes of the reference at the URL</li>
</ul>
<h3 id="fromid-2"><a class="header" href="#fromid-2">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="url"><a class="header" href="#url">url</a></h3>
<ul>
<li>MUST NOT refer to localhost or any reserved IP addresses as defined in <a href="https://datatracker.ietf.org/doc/html/rfc6890">RFC6890</a></li>
<li>Resource MUST be one of the supported <a href="DSNP/Types/../../ActivityContent/Overview.html">Activity Content</a> Types</li>
<li>MUST use one of the supported URL Schemes</li>
</ul>
<h4 id="supported-url-schemes"><a class="header" href="#supported-url-schemes">Supported URL Schemes</a></h4>
<table><thead><tr><th>Scheme</th><th>Description</th><th>Reference</th><th>DSNP Version Added</th></tr></thead><tbody>
<tr><td>HTTPS</td><td>Hypertext Transfer Protocol Secure</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a></td><td>1.0</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reply-announcement"><a class="header" href="#reply-announcement">Reply Announcement</a></h1>
<p>A Reply Announcement is the same as a <a href="DSNP/Types/../Types/Broadcast.html">Broadcast Announcement</a>,
but includes an <code>inReplyTo</code> field for noting it as a reply to a given <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a>.</p>
<h2 id="fields-3"><a class="header" href="#fields-3">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>3</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>contentHash</td><td>keccak-256 hash of content stored at URL</td><td>32 bytes</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
<tr><td>fromId</td><td>id of the user creating the Announcement</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>inReplyTo</td><td>Target <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a></td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>YES</td></tr>
<tr><td>url</td><td>content URL</td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>no</td></tr>
</tbody></table>
<h2 id="field-requirements-3"><a class="header" href="#field-requirements-3">Field Requirements</a></h2>
<h3 id="announcementtype-3"><a class="header" href="#announcementtype-3">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>3</code></li>
</ul>
<h3 id="contenthash-1"><a class="header" href="#contenthash-1">contentHash</a></h3>
<ul>
<li>MUST be the <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hash</a> of the bytes of the reference at the URL</li>
</ul>
<h3 id="fromid-3"><a class="header" href="#fromid-3">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="inreplyto"><a class="header" href="#inreplyto">inReplyTo</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a></li>
</ul>
<h3 id="url-1"><a class="header" href="#url-1">url</a></h3>
<ul>
<li>MUST NOT refer to localhost or any reserved IP addresses as defined in <a href="https://datatracker.ietf.org/doc/html/rfc6890">RFC6890</a></li>
<li>Resource MUST be one of the supported <a href="DSNP/Types/../../ActivityContent/Overview.html">Activity Content</a> Types</li>
<li>MUST use one of the supported URL Schemes</li>
</ul>
<h4 id="supported-url-schemes-1"><a class="header" href="#supported-url-schemes-1">Supported URL Schemes</a></h4>
<table><thead><tr><th>Scheme</th><th>Description</th><th>Reference</th><th>DSNP Version Added</th></tr></thead><tbody>
<tr><td>HTTPS</td><td>Hypertext Transfer Protocol Secure</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a></td><td>1.0</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reaction-announcement"><a class="header" href="#reaction-announcement">Reaction Announcement</a></h1>
<p>A Reaction Announcement is for publishing emoji reactions to anything with a <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a>.</p>
<h2 id="fields-4"><a class="header" href="#fields-4">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>4</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>emoji</td><td>the encoded reaction</td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>YES</td></tr>
<tr><td>apply</td><td>how to apply the reaction</td><td>8-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_8</code></td><td>no</td></tr>
<tr><td>fromId</td><td>id of the user creating the relationship</td><td>64-bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>inReplyTo</td><td>Target <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a></td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>YES</td></tr>
</tbody></table>
<h2 id="field-requirements-4"><a class="header" href="#field-requirements-4">Field Requirements</a></h2>
<h3 id="announcementtype-4"><a class="header" href="#announcementtype-4">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>4</code></li>
</ul>
<h3 id="emoji"><a class="header" href="#emoji">emoji</a></h3>
<ul>
<li>Emoji fields must not be empty</li>
<li>Emoji fields must consist only of <a href="https://unicode.org/standard/standard.html">Unicode points</a> from <code>U+2000</code> to <code>U+2BFF</code>, from <code>U+E000</code> to <code>U+FFFF</code>, or from <code>U+1F000</code> to <code>U+10FFFF</code></li>
</ul>
<h4 id="examples"><a class="header" href="#examples">Examples</a></h4>
<p>All of the following should be considered valid emoji:</p>
<pre><code>&quot;😀&quot;, &quot;🤌🏼&quot;, &quot;👩🏻‍🎤&quot;, &quot;🧑🏿‍🏫&quot;, &quot;🏳️‍🌈&quot;, &quot;🏳️‍⚧️&quot;, &quot;⚛︎&quot;, &quot;🃑&quot;, &quot;♻︎&quot;
</code></pre>
<p>None of the following should be considered valid:</p>
<pre><code>&quot;F&quot;, &quot;:custom-emoji:&quot;, &quot;&lt;custom-emoji&gt;&quot;, &quot;ᚱ&quot;, &quot;ᘐ&quot;, &quot;״&quot;
</code></pre>
<h3 id="apply"><a class="header" href="#apply">apply</a></h3>
<ul>
<li>MUST be a UINT_8
Indicates whether the emoji should be applied and if so, its &quot;strength&quot;.</li>
</ul>
<p>Potential uses:</p>
<ul>
<li>a single reaction</li>
<li>ratings</li>
<li>a range of responses, e.g. &quot;strongly disagree&quot; --&gt; &quot;strongly agree&quot; = 1 --&gt; 5 stars.</li>
<li>recommendation engines</li>
</ul>
<h4 id="apply-enums"><a class="header" href="#apply-enums">Apply Enums</a></h4>
<table><thead><tr><th>Value</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>retract</td><td>Remove the referenced emoji</td></tr>
<tr><td>n</td><td>apply</td><td>Apply the referenced emoji N times</td></tr>
</tbody></table>
<h3 id="fromid-4"><a class="header" href="#fromid-4">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="inreplyto-1"><a class="header" href="#inreplyto-1">inReplyTo</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-content-uri">DSNP Content URI</a></li>
</ul>
<h2 id="non-normative-5"><a class="header" href="#non-normative-5">Non-Normative</a></h2>
<h3 id="likes"><a class="header" href="#likes">Likes</a></h3>
<p>Generic &quot;likes&quot; should default to the <code>&quot;❤️&quot;</code> or Unicode <code>U+FE0F</code> as the emoji in the reaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profile-announcement"><a class="header" href="#profile-announcement">Profile Announcement</a></h1>
<p>A Profile Announcement is a constrained version of a <a href="DSNP/Types/../Types/Broadcast.html">Broadcast Announcement</a>.
The reference content <em>MUST be of profile type</em>.</p>
<h2 id="fields-5"><a class="header" href="#fields-5">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>5</code>)</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>contentHash</td><td>keccak-256 hash of content stored at URL</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
<tr><td>fromId</td><td>id of the user creating the Announcement</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>url</td><td>profile content URL</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>no</td></tr>
</tbody></table>
<h2 id="field-requirements-5"><a class="header" href="#field-requirements-5">Field Requirements</a></h2>
<h3 id="announcementtype-5"><a class="header" href="#announcementtype-5">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>5</code></li>
</ul>
<h3 id="contenthash-2"><a class="header" href="#contenthash-2">contentHash</a></h3>
<ul>
<li>MUST be 32 bytes in length</li>
<li>MUST be the <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hash</a> of the bytes of the reference at the URL</li>
</ul>
<h3 id="fromid-5"><a class="header" href="#fromid-5">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
<li>MUST have authorized the creation of the Announcement, either directly or via a transparent chain of delegation</li>
</ul>
<h3 id="url-2"><a class="header" href="#url-2">url</a></h3>
<ul>
<li>MUST NOT refer to localhost or any reserved IP addresses as defined in <a href="https://datatracker.ietf.org/doc/html/rfc6890">RFC6890</a></li>
<li>Resource MUST be a valid <a href="DSNP/Types/../../ActivityContent/Types/Profile.html">Profile Activity Content</a> Type</li>
<li>MUST use one of the supported URL Schemes</li>
</ul>
<h4 id="supported-url-schemes-2"><a class="header" href="#supported-url-schemes-2">Supported URL Schemes</a></h4>
<table><thead><tr><th>Scheme</th><th>Description</th><th>Reference</th><th>DSNP Version Added</th></tr></thead><tbody>
<tr><td>HTTPS</td><td>Hypertext Transfer Protocol Secure</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a></td><td>1.0</td></tr>
</tbody></table>
<h2 id="non-normative-6"><a class="header" href="#non-normative-6">Non-Normative</a></h2>
<h3 id="most-recent-profile"><a class="header" href="#most-recent-profile">Most Recent Profile</a></h3>
<p>When displaying a DSNP user's profile, the most recent profile should be considered the complete and correct version.
Previous Profile Announcements from the same <code>fromId</code> may be disregarded.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="update-announcement"><a class="header" href="#update-announcement">Update Announcement</a></h1>
<p>An Update Announcement is a way to note intent to update previously
announced content. If the original Broadcast/Reply is Tombstoned, subsequent
Updates should be ignored.</p>
<h2 id="fields-6"><a class="header" href="#fields-6">Fields</a></h2>
<table><thead><tr><th>Field</th><th>Description</th><th>Data Type</th><th>Serialization</th><th>Parquet Type</th><th>Bloom Filter</th></tr></thead><tbody>
<tr><td>announcementType</td><td>Announcement Type Enum (<code>6</code>)</td><td>enum</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>INT32</code></td><td>no</td></tr>
<tr><td>fromId</td><td>id of the user creating the announcement</td><td>64 bit unsigned integer</td><td><a href="DSNP/Types/../Serializations.html#decimal">decimal</a></td><td><code>UINT_64</code></td><td>YES</td></tr>
<tr><td>contentHash</td><td>keccak-256 hash of updated content</td><td>32 bytes</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
<tr><td>url</td><td>updated content URL</td><td>UTF-8</td><td><a href="https://datatracker.ietf.org/doc/html/rfc3629">UTF-8</a></td><td><code>UTF8</code></td><td>no</td></tr>
<tr><td>targetContentHash</td><td>keccak-256 hash of target content</td><td>32 bytes</td><td><a href="DSNP/Types/../Serializations.html#hexadecimal">hexadecimal</a></td><td><code>BYTE_ARRAY</code></td><td>YES</td></tr>
</tbody></table>
<h2 id="field-requirements-6"><a class="header" href="#field-requirements-6">Field Requirements</a></h2>
<h3 id="announcementtype-6"><a class="header" href="#announcementtype-6">announcementType</a></h3>
<ul>
<li>MUST be fixed to <code>6</code></li>
</ul>
<h3 id="fromid-6"><a class="header" href="#fromid-6">fromId</a></h3>
<ul>
<li>MUST be a <a href="DSNP/Types/../Identifiers.html#dsnp-user-id">DSNP User Id</a></li>
</ul>
<h3 id="contenthash-3"><a class="header" href="#contenthash-3">contentHash</a></h3>
<ul>
<li>MUST be the <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hash</a> of the bytes of the reference at the url</li>
</ul>
<h3 id="url-3"><a class="header" href="#url-3">url</a></h3>
<ul>
<li>MUST NOT refer to localhost or any reserved IP addresses as defined in <a href="https://datatracker.ietf.org/doc/html/rfc6890">RFC6890</a></li>
<li>Resource MUST one of the supported <a href="DSNP/Types/../../ActivityContent/Overview.html">Activity Content</a> Types</li>
<li>MUST use one of the supported URL Schemes</li>
</ul>
<h3 id="targetcontenthash-1"><a class="header" href="#targetcontenthash-1">targetContentHash</a></h3>
<ul>
<li>MUST be the <code>contentHash</code> of an allowed Announcement type with the same <code>fromId</code> as the Update Announcement</li>
</ul>
<h4 id="update-allowed-announcement-types"><a class="header" href="#update-allowed-announcement-types">Update Allowed Announcement Types</a></h4>
<table><thead><tr><th>Value</th><th>Name</th></tr></thead><tbody>
<tr><td>2</td><td><a href="DSNP/Types/../Types/Broadcast.html">Broadcast</a></td></tr>
<tr><td>3</td><td><a href="DSNP/Types/../Types/Reply.html">Reply</a></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="serializations"><a class="header" href="#serializations">Serializations</a></h1>
<p>Serialization is how the value should be stringified for signing and for transfer between systems.
Most serializations use outside standards, but some require additional clarifications, provided here.</p>
<h2 id="decimal"><a class="header" href="#decimal">decimal</a></h2>
<p>Used to represent integers.
Strings are used to avoid issues with different implementations of numbers.</p>
<ul>
<li>MUST use 0-9 representation</li>
<li>MUST NOT have spaces or separators</li>
<li>MUST be a string</li>
</ul>
<table><thead><tr><th>Invalid</th><th>Why</th><th>Valid</th></tr></thead><tbody>
<tr><td><code>0x123</code></td><td>Must be decimal</td><td><code>&quot;291&quot;</code></td></tr>
<tr><td>291</td><td>Must be a string</td><td><code>&quot;291&quot;</code></td></tr>
<tr><td><code>291n</code></td><td><code>BigInt(291)</code> serialization appends an <code>n</code></td><td><code>&quot;291&quot;</code></td></tr>
</tbody></table>
<h2 id="hexadecimal"><a class="header" href="#hexadecimal">hexadecimal</a></h2>
<p>Used to represent bytes.</p>
<ul>
<li>MUST use 0-9,a-f representation</li>
<li>MUST be lowercase</li>
<li>MUST be prefixed with a <code>0x</code></li>
<li>MUST NOT have spaces or separators</li>
<li>MUST have two characters per byte in addition to the <code>0x</code> characters</li>
</ul>
<table><thead><tr><th>Bytes</th><th>Invalid</th><th>Valid</th></tr></thead><tbody>
<tr><td>2</td><td><code>0x123</code></td><td><code>0x0123</code></td></tr>
<tr><td>2</td><td><code>123h</code></td><td><code>0x0123</code></td></tr>
<tr><td>2</td><td><code>0x0ABC</code></td><td><code>0x0abc</code></td></tr>
<tr><td>8</td><td><code>0xabc</code></td><td><code>0x0000000000000abc</code></td></tr>
<tr><td>32</td><td><code>0x3e34c4325f4461b9355027b314f3eb56d31af549f7da7bd9ef1ce951651e</code></td><td><code>0x00003e34c4325f4461b9355027b314f3eb56d31af549f7da7bd9ef1ce951651e</code></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dsnp-implementations"><a class="header" href="#dsnp-implementations">DSNP Implementations</a></h1>
<ul>
<li><a href="Ethereum/Overview.html">Ethereum/EVM Compatible</a> (Official)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethereumevm-compatible-dsnp-implementation"><a class="header" href="#ethereumevm-compatible-dsnp-implementation">Ethereum/EVM Compatible DSNP Implementation</a></h1>
<p><strong>Version 1.1.0</strong></p>
<p>DSNP on Ethereum is designed using smart contracts and log messages.
Smart contracts are used for identity and delegation.
Log messages are used for announcement publishing via batches.</p>
<h2 id="solidity"><a class="header" href="#solidity">Solidity</a></h2>
<p>All included Solidity interfaces are targeting the Solidity language version 0.8.x.
Other versions may be available in the <a href="https://github.com/LibertyDSNP/contracts">official contracts code repository</a>.</p>
<h2 id="contracts-and-interfaces"><a class="header" href="#contracts-and-interfaces">Contracts and Interfaces</a></h2>
<p>Official DSNP interfaces, contracts, and deployment information may be found in <a href="https://github.com/LibertyDSNP/contracts">GitHub</a>.</p>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<!-- yaspeller ignore:start -->
<table><thead><tr><th>Name</th><th>Language(s)</th></tr></thead><tbody>
<tr><td><a href="https://github.com/LibertyDSNP/sdk-ts">LibertyDSNP/sdk-ts</a></td><td>JavaScript/TypeScript</td></tr>
</tbody></table>
<!-- yaspeller ignore:end -->
<!--- Uncomment for pre-release changes and prefix the version with `pre-[next version]`
## Prerelease Changelog

- [DIP-###](https://github.com/LibertyDSNP/spec/issues/###)

--->
<h2 id="releases-1"><a class="header" href="#releases-1">Releases</a></h2>
<table><thead><tr><th>Version</th><th>Description</th><th>DSNP Compatibility</th><th>Release Date</th><th>Changelog</th></tr></thead><tbody>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/EVM-v1.1.0">1.1.0</a></td><td>DIP-150, DIP-180</td><td>1.0.x, 1.1.x</td><td>2022-05-06</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/EVM-v1.1.0">Changelog</a></td></tr>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/EVM-v1.0.0">1.0.0</a></td><td>Initial Release</td><td>1.0.x, 1.1.x</td><td>2021-09-09</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/EVM-v1.0.0">Changelog</a></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identity-1"><a class="header" href="#identity-1">Identity</a></h1>
<h2 id="purpose"><a class="header" href="#purpose">Purpose</a></h2>
<ol>
<li>Provide the interface for a DSNP identity.</li>
<li>Specify the delegation model and related interface.</li>
<li>Specify the ownership model and related interface.</li>
<li>Provide the list of EIPs that must be supported by a DSNP-compatible identity.</li>
</ol>
<h2 id="details"><a class="header" href="#details">Details</a></h2>
<h2 id="ownership-1"><a class="header" href="#ownership-1">Ownership</a></h2>
<p>Ownership of an identity on Ethereum is determined by the address of the signer of the content.</p>
<p>Creation of any new identity MUST be authorized by the owner's address.
The official <a href="Ethereum/IdentityFactory.html">Identity Factory</a> is provided for initial creation of a new identity.</p>
<p>Creation of an identity on behalf of someone is described in the <a href="Ethereum/IdentityFactory.html">Identity Factory</a>.</p>
<h3 id="permissioned-owners"><a class="header" href="#permissioned-owners">Permissioned Owners</a></h3>
<p>Ownership is managed through using permissions.
While at least one owner is required, additional public keys may be considered to have ownership and may remove or add other owners.</p>
<h2 id="delegation-1"><a class="header" href="#delegation-1">Delegation</a></h2>
<p>Delegation allows adding additional public keys, in addition to the owner public key(s).
These delegated keys are allowed to perform certain actions on behalf of the owner based on the delegate's &quot;role&quot;.</p>
<h3 id="interface"><a class="header" href="#interface">Interface</a></h3>
<pre><code class="language-solidity">/**
 * @dev DSNP Identity Interface for managing delegates
 */
interface IDelegation {

    struct DelegateAdd {
        uint32 nonce;
        address delegateAddr;
        Role role;
    }

    struct DelegateRemove {
        uint32 nonce;
        address delegateAddr;
    }

    /**
     * @dev Enumerated Permissions
     *      Roles have different permissions
     *      APPEND ONLY
     */
    enum Permission {
        /**
         * @dev 0x0 NONE reserved for no permissions
         */
        NONE,
        /**
         * @dev 0x1 Announce any DSNP message
         */
        ANNOUNCE,
        /**
         * @dev 0x2 Add new delegate
         */
        OWNERSHIP_TRANSFER,
        /**
         * @dev 0x3 Add new delegates
         */
        DELEGATE_ADD,
        /**
         * @dev 0x4 Remove delegates
         */
        DELEGATE_REMOVE
    }

    /**
     * @dev Enumerated Roles
     *      Roles have different permissions
     *      APPEND ONLY
     */
    enum Role {
        /**
         * @dev 0x0 NONE reserved for no permissions
         */
        NONE,
        /**
         * @dev 0x1 OWNER:
         *      - Permission.*
         */
        OWNER,
        /**
         * @dev 0x2 ANNOUNCER:
         *      - Permission.ANNOUNCE
         */
        ANNOUNCER
    }

    /**
     * @dev Log for addition of a new delegate
     * @param delegate Address delegated
     * @param role Permission Role
     */
    event DSNPAddDelegate(address delegate, Role role);

    /**
     * @dev Log for removal of a delegate
     * @param delegate Address revoked
     */
    event DSNPRemoveDelegate(address delegate);

    /**
     * @dev Add or change permissions for delegate
     * @param newDelegate Address to delegate new permissions to
     * @param role Role for the delegate
     *
     * MUST be called by owner or other delegate with permissions
     * MUST consider newDelegate to be valid from the beginning to time
     * MUST emit DSNPAddDelegate
     */
    function delegate(address newDelegate, Role role) external;

    /**
     * @dev Add or change permissions for delegate by EIP-712 signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing new delegate address, role, and nonce
     *
     * MUST be signed by owner or other delegate with permissions (implementation specific)
     * MUST consider newDelegate to be valid from the beginning to time
     * MUST emit DSNPAddDelegate
     */
    function delegateByEIP712Sig(
        uint8 v,
        bytes32 r,
        bytes32 s,
        DelegateAdd calldata change
    ) external;

    /**
     * @dev Remove Delegate
     * @param addr Address to remove all permissions from
     *
     * MUST be called by the delegate, owner, or other delegate with permissions
     * MUST store the block.number as the endBlock for response in isAuthorizedToAnnounce (exclusive)
     *
     * MUST emit DSNPRemoveDelegate
     */
    function delegateRemove(address addr) external;

    /**
     * @dev Remove Delegate By EIP-712 Signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing new delegate address and nonce
     *
     * MUST be signed by the delegate, owner, or other delegate with permissions
     * MUST store the block.number as the endBlock for response in isAuthorizedToAnnounce (exclusive)
     * MUST emit DSNPRemoveDelegate
     */
    function delegateRemoveByEIP712Sig(
        uint8 v,
        bytes32 r,
        bytes32 s,
        DelegateRemove calldata change
    ) external;

    /**
     * @dev Checks to see if address is authorized with the given permission
     * @param addr Address that is used to test
     * @param permission Level of permission check. See Permission for details
     * @param blockNumber Check for authorization at a particular block number, 0x0 reserved for endless permissions
     * @return boolean
     *
     * @dev Immutable assuming operating on confirmed blocks
     */
    function isAuthorizedTo(
        address addr,
        Permission permission,
        uint256 blockNumber
    ) external view returns (bool);

    /**
     * @dev Get a delegate's nonce
     * @param addr The delegate's address to get the nonce for
     *
     * @return nonce value for delegate
     */
    function getNonceForDelegate(address addr) external view returns (uint32);
}
</code></pre>
<h2 id="upgrade-interface"><a class="header" href="#upgrade-interface">Upgrade Interface</a></h2>
<p>It is an open question if we want to require a standard set of upgrade interfaces.</p>
<h2 id="additional-required-interfaces"><a class="header" href="#additional-required-interfaces">Additional Required Interfaces</a></h2>
<h3 id="eip-165"><a class="header" href="#eip-165">EIP 165</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-165">EIP 165</a> provides standard interface detection.
It is required to support optional interfaces and upgrade expansion.</p>
<h2 id="additional-optional-interfaces"><a class="header" href="#additional-optional-interfaces">Additional Optional Interfaces</a></h2>
<h3 id="eip-173"><a class="header" href="#eip-173">EIP 173</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-173">EIP 173</a> provides methods that confirm ownership and provide methods to transfer ownership.
Implementations that choose to use this interface will need to consider that transferring ownership should revoke all existing delegations, or at a minimum all delegates at <code>Role.OWNER</code>.</p>
<h3 id="eip-897"><a class="header" href="#eip-897">EIP 897</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-897">EIP 897</a> is for DSNP identity contracts
that are proxies such as those produced by the default <a href="Ethereum/IdentityFactory.html">Identity Factory</a>.</p>
<h3 id="eip-1271"><a class="header" href="#eip-1271">EIP 1271</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-1271">EIP 1271</a> allows the identity contract to validate a signature.
To support delegation, this interface allows a contract to validate against the signature of the owner.</p>
<p>Unlike <code>IDelegation.isAuthorizedToAnnounce</code> which supports permission levels and end block number, <code>isValidSignature</code> will only respond to currently permissioned addresses at the owner level.</p>
<p><strong>REMEMBER</strong>: Implementation <em>MUST ONLY</em> return true for active owner level.</p>
<h3 id="identity-requirements"><a class="header" href="#identity-requirements">Identity Requirements</a></h3>
<table><thead><tr><th>Interface</th><th>Required</th></tr></thead><tbody>
<tr><td>IDelegation</td><td>Required</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-165">EIP 165</a></td><td>Required</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-897">EIP 897</a></td><td>Proxy Contracts Only</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-173">EIP 173</a></td><td>Optional</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-1271">EIP 1271</a></td><td>Optional</td></tr>
</tbody></table>
<h2 id="rejected-solutions"><a class="header" href="#rejected-solutions">Rejected Solutions</a></h2>
<ul>
<li>Centralized smart contract maintaining identifiers and owners
<ul>
<li>Top Rejection Reasons:
<ul>
<li>A centralized contract must either be controlled by the foundation, a DAO, or non-upgradable</li>
<li>Does not allow for complete flexibility in ownership</li>
</ul>
</li>
</ul>
</li>
<li>Using a single public key as an identifier
<ul>
<li>Top Rejection Reasons:
<ul>
<li>Does not allow for flexibility in ownership</li>
<li>Completely dependent on off-chain software and processing for verification of delegation</li>
</ul>
</li>
</ul>
</li>
<li>Using a single owner model
<ul>
<li>A single owner (as well as the existing EIP 173 to manage it) was considered as opposed to the multi-owner role system</li>
<li>Top Rejection Reasons:
<ul>
<li>Does not allow for flexibility in ownership</li>
<li>Single-owner increases the likelihood of users using choosing less secure key management practices</li>
<li>Multi-owner pairs better with a permissioned system</li>
</ul>
</li>
</ul>
</li>
<li>Using a simple two-tier permission model
<ul>
<li>Owner level and &quot;everything&quot; else</li>
<li>Top Rejection Reasons:
<ul>
<li>Limits options for future specific roles such as social recovery</li>
<li>Cost savings were minimal when paired with a role based system</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identifiers-2"><a class="header" href="#identifiers-2">Identifiers</a></h1>
<p>The <a href="Ethereum/Registry.html">identity registry</a> is the source of building and maintaining a unique DSNP User Id.</p>
<h2 id="creating-and-retrieving-a-dsnp-user-id"><a class="header" href="#creating-and-retrieving-a-dsnp-user-id">Creating and Retrieving a DSNP User Id</a></h2>
<ol>
<li>Create an entry in the <a href="Ethereum/Registry.html">Identity Registry</a> contract.</li>
<li>Use the <code>DSNPRegistryUpdate</code> log event or the <code>resolveRegistration</code> function to retrieve the uint64 <code>id</code></li>
<li>That <code>id</code> value is the DSNP User Id and can be used to generate the <a href="Ethereum/../DSNP/Identifiers.html#dsnp-user-uri">DSNP User URI</a>.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identity-factory"><a class="header" href="#identity-factory">Identity Factory</a></h1>
<p>The least expensive way to create a new identity is through an identity factory.
Official contracts will provide one or more of these standard interfaces to easily generate an identity with different upgrade paths.</p>
<p><strong>Remember:</strong> Using a factory or even a proxy is just an optimization and <em>NOT</em> required.
Any contract that matches the <a href="Ethereum/Identity.html">DSNP Identity</a> interfaces is valid.</p>
<h2 id="purpose-1"><a class="header" href="#purpose-1">Purpose</a></h2>
<ol>
<li>Describe how an Identity Factory can create an identity.</li>
<li>Describe how an Identity Factory can allow someone else to pay for the creation an identity.</li>
<li>Restrict the creation of identities without owner permission.</li>
</ol>
<h2 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h2>
<ul>
<li>All assumptions from <a href="Ethereum/Identity.html">DSNP Identity</a></li>
</ul>
<h2 id="proxy-contracts"><a class="header" href="#proxy-contracts">Proxy Contracts</a></h2>
<p>While it is not required, most of the DSNP Identity compatible contracts are proxy contracts.
Proxy contracts are often created through a factory contract.
Here are the interfaces to be a DSNP-compatible identity factory.</p>
<h3 id="what-is-a-proxy-contract"><a class="header" href="#what-is-a-proxy-contract">What is a Proxy Contract?</a></h3>
<p>Proxy contracts are used to limit the gas for deploying many contracts that all have the same logic, but need different state.
The state is maintained at the &quot;proxy&quot; contract while the logic to alter the state is able to be in one &quot;logic&quot; contract.</p>
<p><strong>Remember: A Logic Contract has 100% control over the state of a smart contract.</strong>
While a logic contract cannot have state that effects the execution of a proxy contract,
a logic contract's code can be written in such a way that allows for others to take control of a contract.
Never use logic contracts that you do not trust!</p>
<h3 id="what-are-the-different-types-of-proxy-contracts"><a class="header" href="#what-are-the-different-types-of-proxy-contracts">What are the different types of Proxy Contracts?</a></h3>
<p><a href="https://docs.openzeppelin.com/contracts/4.x/api/proxy">OpenZeppelin</a> has a great set of standard and audited proxy contracts.</p>
<p>While there may not be an identity factory interface for each type, the documentation from OpenZeppelin gives good detail on the differences between the types.</p>
<h3 id="can-i-switch-from-one-type-to-another"><a class="header" href="#can-i-switch-from-one-type-to-another">Can I switch from one type to another?</a></h3>
<p>Switching types is possible, but difficult.
See <a href="Ethereum/Registry.html">Identity Registry</a> for more information on changing an identity contract to another type.</p>
<h3 id="data-storage-and-eip-1967"><a class="header" href="#data-storage-and-eip-1967">Data storage and EIP 1967</a></h3>
<p>Due to the state management system that Ethereum uses, it can easily cause issues for upgradable contracts.
<a href="https://eips.ethereum.org/EIPS/eip-1967">EIP 1967</a> provides for ways to safely use state that will not collide.
Implementations of upgradable proxies MUST use EIP 1967 style data storage.</p>
<h3 id="logic-contract-constraints"><a class="header" href="#logic-contract-constraints">Logic Contract Constraints</a></h3>
<p>Contracts that are used as the logic for the proxy are not able to use constructors for initialization.
Proxy contracts however can have constructors and additionally the factory can be used to call methods once the proxy is created.
Remember that setting up the initial authorization state of a contract MUST be done in a single transaction to prevent others sniping the contract.</p>
<h2 id="factory"><a class="header" href="#factory">Factory</a></h2>
<p>An identity factory will give easy methods to allow for the creation of proxy contracts that function as DSNP Identities.
Official implementation contract addresses will be published once deployed.</p>
<h3 id="clone-interface"><a class="header" href="#clone-interface">Clone Interface</a></h3>
<p>Clones follow <a href="https://eips.ethereum.org/EIPS/eip-1167">EIP 1167</a> for a <strong>non-upgradable</strong> identity contract.</p>
<pre><code class="language-solidity">/**
 * @dev DSNP Identity Factory Interface for creating identities via [EIP 1167](https://eips.ethereum.org/EIPS/eip-1167)
 */
interface IIdentityCloneFactory {

    /**
     * @dev event to log the created proxy contract address
     */
    event ProxyCreated(address addr);

    /**
     * @dev Creates a new identity with the message sender as the owner
     * @dev [EIP 1167](https://eips.ethereum.org/EIPS/eip-1167) Proxy
     * @param logic The address to use for the logic contract
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createCloneProxy(address logic) public returns (address);

    /**
     * @dev Creates a new identity with the ecrecover address as the owner
     * @dev [EIP 1167](https://eips.ethereum.org/EIPS/eip-1167) Proxy
     * @param logic The address to use for the logic contract
     * @param owner The initial owner's address of the new contract
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createCloneProxyWithOwner(address logic, address owner) external returns (address);
}
</code></pre>
<h3 id="upgradable-proxy-interface"><a class="header" href="#upgradable-proxy-interface">Upgradable Proxy Interface</a></h3>
<p>Upgradable Proxies can be upgraded by the owner or permissioned delegates.</p>
<pre><code class="language-solidity">/**
 * @dev DSNP Identity Factory Interface for creating upgradable identities
 */
interface IIdentityUpgradableFactory {

    /**
     * @dev event to log the created proxy contract address
     */
    event ProxyCreated(address addr);

    /**
     * @dev Logs updates to the suggested logic contract
     * @dev MUST BE emitted when the contract changes the suggested logic address
     * @param newLogic The new address
     */
    event LogicUpdated(address newLogic);

    /**
     * @dev This may be upgradable by the owner of the factory
     *
     * @return The current logic contract suggested by this factory
     */
    function getLogic() external view returns (address);

    /**
     * @dev Creates a new identity with the message sender as the owner
     *      and will be pointed at the default logic address.
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createUpgradableProxy() external returns (address);

    /**
     * @dev Creates a new identity with the message sender as the owner
     * @param logic The address to use for the logic contract
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createUpgradableProxy(address logic) external returns (address);

    /**
     * @dev Creates a new identity with the ecrecover address as the owner
     * @param logic The logic address to use for identity creation
     * @param owner The initial owner's address of the new contract
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createUpgradableProxyWithOwner(address logic, address owner) external returns (address);
}
</code></pre>
<h3 id="beacon-factory-interface"><a class="header" href="#beacon-factory-interface">Beacon Factory Interface</a></h3>
<p>Beacon Proxies will use the beacon's logic address and will be upgraded when the beacon's logic address is changed.
This is the suggested factory for use on Betanet to remain up to date.</p>
<pre><code class="language-solidity">/**
 * @dev DSNP Identity Factory Interface for creating beacon following identities
 */
interface IIdentityBeaconFactory {

    /**
     * @dev event to log the created proxy contract address
     */
    event ProxyCreated(address addr);

    /**
     * @dev This MUST NOT be upgradable by the owner of the factory
     *
     * @return The current beacon contract suggested by this factory
     */
    function getBeacon() external view returns (address);

    /**
     * @dev Creates a new identity with the message sender as the owner
     *      Uses the beacon defined by getBeacon()
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createBeaconProxy() external returns (address);

    /**
     * @dev Creates a new identity with the message sender as the owner
     * @param beacon The beacon address to use for logic contract resolution
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createBeaconProxy(address beacon) external returns (address);

    /**
     * @dev Creates a new identity with the ecrecover address as the owner
     * @param beacon The beacon address to use logic contract resolution
     * @param owner The initial owner's address of the new contract
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @return The address of the newly created proxy contract
     */
    function createBeaconProxyWithOwner(address beacon, address owner) external returns (address);

    /**
     * @dev Creates a new identity with the address as the owner and registers it with a handle
     * @param beacon The beacon address to use logic contract resolution
     * @param owner The initial owner's address of the new contract
     * @param handle The handle the new identity proxy under which should be registered
     *
     * @dev This MUST emit ProxyCreated with the address of the new proxy contract
     * @dev This MUST revert if registration reverts
     * @dev This MUST emit a DSNPRegistryUpdate
     */
    function createAndRegisterBeaconProxy(
        address beacon,
        address owner,
        string calldata handle
    ) external;
}
</code></pre>
<h3 id="beacon-interface"><a class="header" href="#beacon-interface">Beacon Interface</a></h3>
<p>A beacon contract follows the same interface as the OpenZeppelin 4 <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.0.0/contracts/proxy/beacon/IBeacon.sol">IBeacon</a>.
Updating the beacon logic address is left to the implementation of the beacon, but the OpenZeppelin 4 <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.0.0/contracts/proxy/beacon/UpgradeableBeacon.sol">UpgradeableBeacon</a> is suggested.</p>
<pre><code class="language-solidity">/**
 * @dev This is the interface that {BeaconProxy} expects of its beacon.
 */
interface IBeacon {
    /**
     * @dev Must return an address that can be used as a delegate call target.
     *      This follows the interface from OpenZeppelin 4.0.0 [IBeacon](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.0.0/contracts/proxy/beacon/IBeacon.sol)
     *
     * @return A contract address that implements the logic for the proxy
     */
    function implementation() external view returns (address);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identity-registry"><a class="header" href="#identity-registry">Identity Registry</a></h1>
<p>A registry allows for distinct user identifiers and human readable discovery of network members.
The DSNP User Id Registry is a simple contract that allows switching handles, identity contracts, and chain migration while maintaining all graph connections, public and private.</p>
<h2 id="purpose-2"><a class="header" href="#purpose-2">Purpose</a></h2>
<ol>
<li>Describes how the Identity Registry resolves a DSNP User Id to an identity contract address.</li>
<li>Describes how the Identity Registry allows for handle resolution.</li>
<li>Presents the interface for the Identity Registry.</li>
<li>Describes rejected alternatives.</li>
</ol>
<h2 id="assumptions-1"><a class="header" href="#assumptions-1">Assumptions</a></h2>
<ul>
<li>Ids will need to be moved from Betanet to Mainnet.</li>
<li>Handles are for display and discovery purposes only.</li>
</ul>
<h2 id="discovery-via-dsnp-handles"><a class="header" href="#discovery-via-dsnp-handles">Discovery via DSNP Handles</a></h2>
<ul>
<li>Contract addresses or numerical ids are not easy to remember.</li>
<li>Most networks rely on text based handles for discovery of users on a network.</li>
<li>DSNP handles are an easy way to allow easy user lookup.</li>
</ul>
<h3 id="handles"><a class="header" href="#handles">Handles</a></h3>
<ul>
<li>Handles are simple UTF-8 strings.</li>
<li>No limitations are placed on length or contents, although different clients may not have support for the full unicode set.</li>
<li>A user MAY NOT register multiple handles that point to the same DSNP User Id.</li>
<li>Handles must be unique.</li>
</ul>
<h3 id="homograph-attack-mitigation"><a class="header" href="#homograph-attack-mitigation">Homograph Attack Mitigation</a></h3>
<p>UTF-8 support for handles opens handle users up to <a href="https://en.wikipedia.org/wiki/IDN_homograph_attack">homograph attacks</a>, not to mention case-sensitivity issues.
This issue is of ongoing discussion both for the DSNP as well as in for ICANN domain names and other projects working with internationalization support.</p>
<p>Because the DSNP User Id is stable, attacks would only be successful in cases where the DSNP User Id were unknown.
<a href="https://en.wikipedia.org/wiki/Punycode">Punycode</a> is used by some software to prevent homographs by encoding all non-Latin characters into Latin characters.
So Punycode does not properly present non-Latin characters which isn't reaching the level of internationalization support desired by the DSNP.</p>
<h4 id="current-mitigation-strategies"><a class="header" href="#current-mitigation-strategies">Current Mitigation Strategies</a></h4>
<p>Clients resolving handles MUST implement a method to detect potential homographs and check both user settings and potentially check the registry for additional potential matching DSNP User Ids.</p>
<h3 id="eip-712-methods-replay-attacks-and-nonces"><a class="header" href="#eip-712-methods-replay-attacks-and-nonces">EIP 712 Methods, Replay Attacks and Nonces</a></h3>
<p>The Registry supports EIP 712 methods to permit a second party to pay gas costs for address and handle changes.
Once an EIP 712 transaction is made, anyone may replay that action without further authorization.
This breaks our security guarantees when the registration owner has made an additional change to either address or handle.
To mitigate this, the Registry contract MUST store a nonce for every registration.
When it receives an EIP 712 transaction, it MUST check that the nonce parameter matches the stored nonce, and it MUST increment the stored nonce if the transaction succeeds.</p>
<p>If a handle is changed, the registry MUST preserve the stored nonce for the old handle.</p>
<h2 id="dsnp-user-ids"><a class="header" href="#dsnp-user-ids">DSNP User Ids</a></h2>
<p>Ethereum contract addresses are currently 160 bit values which is much larger than needed for unique identification.
Identification can be reduced to just 64 bit identifiers with the registry and enable contract changing.</p>
<p><strong>Remember:</strong> Only DSNP User Ids are safe for long term data connections.</p>
<ul>
<li>DSNP Identity contract addresses are not guaranteed long term for upgrade and migration reasons.</li>
<li>Handles can change.</li>
</ul>
<h2 id="resolutions"><a class="header" href="#resolutions">Resolutions</a></h2>
<p>Resolutions are possible between any of the three pieces of data: Handle, DSNP User Id, and Contract Address.
While a utility method is provided for ease of moving from handle to the contract address,
the other resolutions require using contract log events.</p>
<h3 id="current-handle---current-dsnp-user-id-and-contract-address"><a class="header" href="#current-handle---current-dsnp-user-id-and-contract-address">Current Handle -&gt; Current DSNP User Id and Contract Address</a></h3>
<p><code>IRegistry.resolveRegistration</code> provides easy access to the current registration for the given handle.</p>
<h3 id="current-handle---nonce"><a class="header" href="#current-handle---nonce">Current Handle -&gt; Nonce</a></h3>
<p>The <code>IRegistry.resolveHandleToNonce</code> method is the only method for discovery of the next nonce to use.</p>
<h3 id="other-lookups--historical-values"><a class="header" href="#other-lookups--historical-values">Other Lookups &amp; Historical Values</a></h3>
<p>The <code>DSNPRegistryUpdate</code> event is provided to resolve DSNP User Ids, handles, and contract addresses.
The DSNP User Id and contract address are indexed in the event so use a log search using the event and the search data as topics.</p>
<p>A search by contract address may produce more than one result meaning that the contract address is currently or previously attached to other DSNP User Ids.
To test for the current value, the query would need to be run again with each of the resulting DSNP User Ids retrieving the most recent <code>DSNPRegistryUpdate</code> event.</p>
<p>A search by DSNP User Id will retrieve the history of all handles and contract addresses that have been connected to that DSNP User Id.
The most recent event (the one with the highest block number), will give the current handle and contract address for the given DSNP User Id.</p>
<p>Handles may be reused if a DSNP User Id changes to a new handle.
While time consuming, discovering previous owners of a given handle requires locally filtering all <code>DSNPRegistryUpdate</code> events for events with the given handle.</p>
<h2 id="eip-721"><a class="header" href="#eip-721">EIP 721</a></h2>
<p>DSNP support for the NFT standard <a href="https://eips.ethereum.org/EIPS/eip-721">EIP 721</a> for handles is under consideration.</p>
<h3 id="nft-concerns"><a class="header" href="#nft-concerns">NFT Concerns</a></h3>
<ul>
<li>The EIP 721 standard has its own ownership and permission system that is too limited for use across the DSNP.</li>
<li>Supporting two ownership systems adds needless complexity.</li>
<li>Identity contract ownership would require additional complexity to receive and transfer 721 tokens.</li>
</ul>
<h2 id="rejected-alternatives-1"><a class="header" href="#rejected-alternatives-1">Rejected Alternatives</a></h2>
<ul>
<li>Why not the Ethereum Name Service (<a href="https://ens.domains/">ENS</a>)?
<ul>
<li>Overly complex and expensive for the simple use case of handles</li>
<li>Support can be added later through custom ENS resolution</li>
<li>Didn't provide a numerical id for efficient graph storage</li>
<li>Still subject to homograph attacks</li>
</ul>
</li>
</ul>
<h2 id="contract-interface"><a class="header" href="#contract-interface">Contract Interface</a></h2>
<pre><code class="language-solidity">/**
 * @dev DSNP Registry Interface
 * @dev Suggested data storage implementation:
 *   uint64 internal currentIdSequenceMarker = 0x1; // Must not start at 0
 *   mapping(string =&gt; [id, address]) internal handleToIdAndAddress;
 */
interface IRegistry {
    struct AddressChange {
        uint32 nonce;
        address addr;
        string handle;
    }

    struct HandleChange {
        uint32 nonce;
        string oldHandle;
        string newHandle;
    }

    /**
     * @dev Log when a resolution address is changed
     * @param id The DSNP User Id
     * @param addr The address the DSNP User Id is pointing at
     * @param handle The actual UTF-8 string used for the handle
     */
    event DSNPRegistryUpdate(uint64 indexed id, address indexed addr, string handle);

    /**
     * @dev Register a new DSNP User Id
     * @param addr Address for the new DSNP User Id to point at
     * @param handle The handle for discovery
     *
     * MUST reject if the handle is already in use
     * MUST emit DSNPRegistryUpdate
     * MUST check that addr implements IDelegation interface
     * @return id for new registration
     */
    function register(address addr, string calldata handle) external returns (uint64);

    /**
     * @dev Alter a DSNP User Id resolution address
     * @param newAddr Original or new address to resolve to
     * @param handle The handle to modify
     *
     * MUST be called by someone who is authorized on the contract
     *      via `IDelegation(oldAddr).isAuthorizedTo(oldAddr, Permission.OWNERSHIP_TRANSFER, block.number)`
     * MUST emit DSNPRegistryUpdate
     * MUST check that newAddr implements IDelegation interface
     */
    function changeAddress(address newAddr, string calldata handle) external;

    /**
     * @dev Alter a DSNP User Id resolution address by EIP-712 Signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing nonce, new address and handle
     *
     * MUST be signed by someone who is authorized on the contract
     *      via `IDelegation(oldAddr).isAuthorizedTo(ecrecovedAddr, Permission.OWNERSHIP_TRANSFER, block.number)`
     * MUST check that newAddr implements IDelegation interface
     * MUST emit DSNPRegistryUpdate
     */
    function changeAddressByEIP712Sig(uint8 v, bytes32 r, bytes32 s, AddressChange calldata change) external;

    /**
     * @dev Alter a DSNP User Id handle
     * @param oldHandle The previous handle for modification
     * @param newHandle The new handle to use for discovery
     *
     * MUST NOT allow a registration of a handle that is already in use
     * MUST be called by someone who is authorized on the contract
     *      via `IDelegation(oldHandle -&gt; addr).isAuthorizedTo(ecrecovedAddr, Permission.OWNERSHIP_TRANSFER, block.number)`
     * MUST emit DSNPRegistryUpdate
     */
    function changeHandle(string calldata oldHandle, string calldata newHandle) external;

    /**
     * @dev Alter a DSNP User Id handle by EIP-712 Signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing nonce, old handle and new handle
     *
     * MUST NOT allow a registration of a handle that is already in use
     * MUST be signed by someone who is authorized on the contract
     *      via `IDelegation(handle -&gt; addr).isAuthorizedTo(ecrecovedAddr, Permission.OWNERSHIP_TRANSFER, block.number)`
     * MUST emit DSNPRegistryUpdate
     */
    function changeHandleByEIP712Sig(uint8 v, bytes32 r, bytes32 s, HandleChange calldata change) external;

    /**
     * @dev Resolve a handle to a DSNP User Id and contract address
     * @param handle The handle to resolve
     *
     * Returns zeros if not found
     * @return A tuple of the DSNP User Id and the Address of the contract
     */
    function resolveRegistration(string calldata handle) view external returns (uint64, address);

    /**
     * @dev Resolve a handle to a EIP 712 nonce
     * @param handle The handle to resolve
     *
     * rejects if not found
     * @return expected nonce for next EIP 712 update
     */
    function resolveHandleToNonce(string calldata handle) view external returns (uint32);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="announcement-publishing"><a class="header" href="#announcement-publishing">Announcement Publishing</a></h1>
<p>On Ethereum, all <a href="Ethereum/../DSNP/Announcements.html">Announcements</a> are published via <a href="Ethereum/../DSNP/BatchPublications.html">Batch Publication Files</a>.
Publishing is accomplished via an Ethereum Log Event.</p>
<h2 id="ethereum-log-event"><a class="header" href="#ethereum-log-event">Ethereum Log Event</a></h2>
<p>The event topic for <code>DSNPBatchPublication</code> follows the standard Solidity event name to hash standard.</p>
<pre><code>0xe63a4904ccacc079f71e52aad2cf99c00a7d4963566562a94d7c07610f1df576 = keccak-256(&quot;DSNPBatchPublication(int16,bytes32,string)&quot;)
</code></pre>
<h3 id="log-event-data"><a class="header" href="#log-event-data">Log Event Data</a></h3>
<table><thead><tr><th>Field</th><th>Description</th><th>Type</th><th>Indexed</th></tr></thead><tbody>
<tr><td><code>announcementType</code></td><td>The single announcement type in the given file</td><td>int16</td><td>YES</td></tr>
<tr><td><code>fileHash</code></td><td><a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256</a> hash of the batch file</td><td>bytes32</td><td>no</td></tr>
<tr><td><code>fileUrl</code></td><td>URL to retrieve the referenced batch file via an <a href="Ethereum/Publishing.html#batch-file-retrieval">approved schema</a></td><td>string</td><td>no</td></tr>
</tbody></table>
<h2 id="batch-file-retrieval"><a class="header" href="#batch-file-retrieval">Batch File Retrieval</a></h2>
<ul>
<li>Batch File URLs MUST NOT refer to localhost or any reserved IP addresses as defined in <a href="https://datatracker.ietf.org/doc/html/rfc6890">RFC6890</a>.</li>
<li>Batch File URLs MUST use one of the supported URL Schemes.</li>
</ul>
<h3 id="supported-url-schemes-3"><a class="header" href="#supported-url-schemes-3">Supported URL Schemes</a></h3>
<table><thead><tr><th>Scheme</th><th>Description</th><th>Reference</th><th>DSNP Version Added</th></tr></thead><tbody>
<tr><td>HTTPS</td><td>Hypertext Transfer Protocol Secure</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a></td><td>1.0</td></tr>
</tbody></table>
<h2 id="ordering"><a class="header" href="#ordering">Ordering</a></h2>
<p>The <code>DSNPBatchPublication</code> Ethereum events are ordered by information provided in the transaction.</p>
<ol>
<li><code>DSNPBatchPublication</code> Block number ascending</li>
<li><code>DSNPBatchPublication</code> Transaction index ascending</li>
<li><code>DSNPBatchPublication</code> Log index ascending</li>
<li>DSNP Standard: Order Announcements in a Batch Publication File by row appearance order</li>
</ol>
<h2 id="publisher-contract-requirements"><a class="header" href="#publisher-contract-requirements">Publisher Contract Requirements</a></h2>
<p>Contracts that allow for generating <code>DSNPBatchPublication</code> are called publishers.
A standard interface is available for use.</p>
<table><thead><tr><th>Interface</th><th>Required</th></tr></thead><tbody>
<tr><td><a href="Ethereum/Publishing.html#ipublish-interface">IPublish</a></td><td>Required</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-165">ERC165</a></td><td>Optional</td></tr>
</tbody></table>
<h2 id="ipublish-interface"><a class="header" href="#ipublish-interface">IPublish Interface</a></h2>
<pre><code class="language-solidity">interface IPublish {
    struct Publication {
        int16 announcementType;
        string fileUrl;
        bytes32 fileHash;
    }

    /**
     * @dev Log Event for each batch published
     * @param announcementType The type of Announcement in the batch file
     * @param fileHash The keccak hash of the batch file
     * @param fileUrl A url that resolves to the batch file
     */
    event DSNPBatchPublication(int16 indexed announcementType, bytes32 fileHash, string fileUrl);

    /**
     * @param publications Array of Batch struct to publish
     */
    function publish(Publication[] calldata publications) external;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="announcement-validation-1"><a class="header" href="#announcement-validation-1">Announcement Validation</a></h1>
<p>DSNP Announcements on Ethereum are validated at read time.</p>
<ol>
<li>Read <code>DSNPBatchPublication</code> events.</li>
<li>Fetch and validate the Batch Publication.</li>
<li>Validate the chain of delegation from the Announcement's <code>fromId</code> to the sender of the transaction with the <code>DSNPBatchPublication</code> event.</li>
</ol>
<h2 id="batch-publication-validation"><a class="header" href="#batch-publication-validation">Batch Publication Validation</a></h2>
<ol>
<li>Hash the batch publication file using <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256</a>.</li>
<li>Retrieve the published hash for the given file from the <a href="Ethereum/Publishing.html">DSNPBatchPublication</a> Event.</li>
<li>The file hash MUST match the retrieved hash from the <code>DSNPBatchPublication</code> event.</li>
</ol>
<h2 id="announcement-validation-2"><a class="header" href="#announcement-validation-2">Announcement Validation</a></h2>
<ol>
<li>Get the Ethereum address of the sender for the transaction from the Batch (aka the Batch Publisher).</li>
<li>Find the <a href="Ethereum/Identity.html">Identity Contract</a> for the Announcement's <code>fromId</code>.</li>
<li>Test the Batch Publisher's Ethereum address against the Identity Contract via <code>IDelegation.isAuthorizedTo</code> with the permission <code>ANNOUNCE</code> and the block number from the <code>DSNPBatchPublication</code> event.</li>
</ol>
<h2 id="announcement-duplicates"><a class="header" href="#announcement-duplicates">Announcement Duplicates</a></h2>
<p>Duplicate Announcements MUST be rejected or ignored.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="activity-content-specification"><a class="header" href="#activity-content-specification">Activity Content Specification</a></h1>
<p><strong>Version 1.1.0</strong></p>
<p>Content references shared via the DSNP consists of URLs pointing to documents containing Activity Streams JSON objects.
For the purposes of the DSNP, restrictions are placed on the <a href="https://www.w3.org/TR/activitystreams-core/">Activity Streams 2.0</a> specification.</p>
<h2 id="json-ld-and-activity-streams"><a class="header" href="#json-ld-and-activity-streams">JSON-LD and Activity Streams</a></h2>
<p>All DSNP Activity Content is compatible with the <a href="https://www.w3.org/TR/activitystreams-core/">Activity Streams 2.0</a> specification.
While there are some DSNP extensions, they are guaranteed to use non-colliding terms.
Therefore, we set the JSON-LD <code>@context</code> field to <code>https://www.w3.org/ns/activitystreams</code> according to <a href="https://www.w3.org/TR/activitystreams-core/#jsonld">Activity Streams 2.0 §2.1</a>.</p>
<h2 id="core-activity-content-types"><a class="header" href="#core-activity-content-types">Core Activity Content Types</a></h2>
<p>DSNP uses only the following content types at the root level.</p>
<table><thead><tr><th>Name</th><th>Description</th><th>DSNP Announcements</th></tr></thead><tbody>
<tr><td><a href="ActivityContent/Types/Note.html">Note</a></td><td>standard user content</td><td><a href="ActivityContent/../DSNP/Types/Broadcast.html">Broadcast</a>, <a href="ActivityContent/../DSNP/Types/Reply.html">Reply</a></td></tr>
<tr><td><a href="ActivityContent/Types/Profile.html">Profile</a></td><td>user profile content</td><td><a href="ActivityContent/../DSNP/Types/Profile.html">Profile</a></td></tr>
</tbody></table>
<h2 id="associated-types"><a class="header" href="#associated-types">Associated Types</a></h2>
<table><thead><tr><th>Name</th><th>Description</th><th>Specification</th></tr></thead><tbody>
<tr><td><a href="ActivityContent/Associated/Location.html">Location</a></td><td>add a location to content</td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/">Activity Vocabulary</a></td></tr>
<tr><td><a href="ActivityContent/Associated/Tag.html">Tag</a></td><td>add a tag to content</td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/">Activity Vocabulary</a></td></tr>
<tr><td><a href="ActivityContent/Associated/Attachments.html">Attachments</a></td><td>supported attachment types</td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/">Activity Vocabulary</a></td></tr>
<tr><td><a href="ActivityContent/Associated/Hash.html">Hash</a></td><td>content validation hash</td><td>DSNP Extension</td></tr>
</tbody></table>
<h2 id="supported-url-schema"><a class="header" href="#supported-url-schema">Supported URL Schema</a></h2>
<p>URLs in DSNP-compatible Activity Content MUST to use one of the following URL schemes.</p>
<table><thead><tr><th>Scheme</th><th>Description</th><th>Reference</th><th>DSNP Version Added</th></tr></thead><tbody>
<tr><td>HTTPS</td><td>Hypertext Transfer Protocol Secure</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a></td><td>1.0</td></tr>
<tr><td>HTTP</td><td>Hypertext Transfer Protocol</td><td><a href="https://datatracker.ietf.org/doc/html/rfc2616">RFC2616</a></td><td>1.0</td></tr>
</tbody></table>
<h2 id="libraries-1"><a class="header" href="#libraries-1">Libraries</a></h2>
<table><thead><tr><th>Name</th><th>Language(s)</th></tr></thead><tbody>
<tr><td><a href="https://github.com/LibertyDSNP/activity-content">LibertyDSNP/activity-content</a></td><td>JavaScript/TypeScript</td></tr>
<tr><td><a href="https://github.com/LibertyDSNP/activity-content-java">LibertyDSNP/activity-content-java</a></td><td>Java/Kotlin</td></tr>
<tr><td><a href="https://github.com/LibertyDSNP/activity-content-swift">LibertyDSNP/activity-content-swift</a></td><td>Swift</td></tr>
</tbody></table>
<!--- Uncomment for pre-release changes and prefix the version with `pre-[next version]`
## Prerelease Changelog

- [DIP-###](https://github.com/LibertyDSNP/spec/issues/###)

--->
<h2 id="releases-2"><a class="header" href="#releases-2">Releases</a></h2>
<table><thead><tr><th>Version</th><th>Description</th><th>Release Date</th><th>Changelog</th></tr></thead><tbody>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/ActivityContent-v1.1.0">1.1.0</a></td><td>DIP-158</td><td>2022-05-05</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/ActivityContent-v1.1.0">Changelog</a></td></tr>
<tr><td><a href="https://github.com/LibertyDSNP/spec/tree/ActivityContent-v1.0.0">1.0.0</a></td><td>Initial Release</td><td>2021-09-09</td><td><a href="https://github.com/LibertyDSNP/spec/releases/tag/ActivityContent-v1.0.0">Changelog</a></td></tr>
</tbody></table>
<h2 id="non-normative-7"><a class="header" href="#non-normative-7">Non-Normative</a></h2>
<h2 id="additional-fields"><a class="header" href="#additional-fields">Additional Fields</a></h2>
<p>Implementers may choose to support more of the Activity Streams standard as long as it does not conflict with this specification, but as a warning, other implementations may not recognize those additions.
Implementers who extend their support for Activity Streams objects beyond the subset defined here do so at their own risk.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="activity-stream-type-note"><a class="header" href="#activity-stream-type-note">Activity Stream Type: Note</a></h1>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-note">Activity Vocabulary: Note</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>@context</code></td><td><a href="https://www.w3.org/TR/activitystreams-core/#jsonld">Activity Streams 2.0</a></td><td>YES</td><td>JSON-LD @context</td><td>MUST be set to <code>https://www.w3.org/ns/activitystreams</code></td></tr>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Note</code></td></tr>
<tr><td><code>content</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-content">Activity Vocabulary 2.0</a></td><td>YES</td><td>Text content of the note</td><td></td></tr>
<tr><td><code>mediaType</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-mediatype">Activity Vocabulary 2.0</a></td><td>YES</td><td>MIME type for the <code>content</code> field</td><td>MUST be set to a <a href="ActivityContent/Types/Note.html#supported-content-mime-types">supported MIME type</a></td></tr>
<tr><td><code>published</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-published">Activity Vocabulary 2.0</a></td><td>YES</td><td>The time of publishing</td><td>MUST be <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO8601</a></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name for the note</td><td></td></tr>
<tr><td><code>attachment</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-attachment">Activity Vocabulary 2.0</a></td><td>no</td><td>Array of attached links or media</td><td>MUST be one of the <a href="ActivityContent/Types/../Associated/Attachments.html">Supported Attachments</a></td></tr>
<tr><td><code>tag</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-tag">Activity Vocabulary 2.0</a></td><td>no</td><td>Array of tags/mentions</td><td>MUST follow <a href="ActivityContent/Types/../Associated/Tag.html">Tag Type</a></td></tr>
<tr><td><code>location</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-location">Activity Vocabulary 2.0</a></td><td>no</td><td>For location</td><td>MUST follow <a href="ActivityContent/Types/../Associated/Location.html">Location Type</a></td></tr>
</tbody></table>
<h2 id="supported-content-mime-types"><a class="header" href="#supported-content-mime-types">Supported Content MIME Types</a></h2>
<table><thead><tr><th>Format</th><th>MIME Type</th><th>Specification(s)</th></tr></thead><tbody>
<tr><td>Plain</td><td><code>text/plain</code></td><td></td></tr>
</tbody></table>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;Hello world!&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;summary&quot;: &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;,
  &quot;attachment&quot;: [
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;href&quot;: &quot;https://en.wikipedia.org/wiki/Citation_needed&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="activity-stream-type-profile"><a class="header" href="#activity-stream-type-profile">Activity Stream Type: Profile</a></h1>
<p>Profiles are used to provide additional user information display.</p>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-profile">Activity Vocabulary: Profile</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>@context</code></td><td><a href="https://www.w3.org/TR/activitystreams-core/#jsonld">Activity Streams 2.0</a></td><td>YES</td><td>JSON-LD @context</td><td>MUST be set to <code>https://www.w3.org/ns/activitystreams</code></td></tr>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Profile</code></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name for the profile</td><td></td></tr>
<tr><td><code>icon</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-icon">Activity Vocabulary 2.0</a></td><td>no</td><td>An array of avatars of the profile</td><td>MUST follow <a href="ActivityContent/Types/../Associated/Attachments.html#image-link">Image Link Type</a></td></tr>
<tr><td><code>summary</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-summary">Activity Vocabulary 2.0</a></td><td>no</td><td>Used as a plain text biography of the profile</td><td></td></tr>
<tr><td><code>published</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-published">Activity Vocabulary 2.0</a></td><td>no</td><td>The time of publishing</td><td>MUST be <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO8601</a></td></tr>
<tr><td><code>location</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-location">Activity Vocabulary 2.0</a></td><td>no</td><td>For location</td><td>MUST follow <a href="ActivityContent/Types/../Associated/Location.html">Location Type</a></td></tr>
<tr><td><code>tag</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-tag">Activity Vocabulary 2.0</a></td><td>no</td><td>For tags or mentions</td><td>MUST follow <a href="ActivityContent/Types/../Associated/Tag.html">Tag Type</a></td></tr>
</tbody></table>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Profile&quot;,
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;summary&quot;: &quot;John Doe is actually a small kitten. See pfp.&quot;,
  &quot;icon&quot;: [
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;href&quot;: &quot;https://placekitten.com/256/256&quot;,
      &quot;mediaType&quot;: &quot;image/jpeg&quot;,
      &quot;width&quot;: &quot;256&quot;,
      &quot;height&quot;: &quot;256&quot;
    },
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;href&quot;: &quot;https://placekitten.com/64/64&quot;,
      &quot;mediaType&quot;: &quot;image/jpeg&quot;,
      &quot;width&quot;: &quot;64&quot;,
      &quot;height&quot;: &quot;64&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="associated-type-hash"><a class="header" href="#associated-type-hash">Associated Type: Hash</a></h1>
<p><em>NOT</em> part of the Activity Streams 2.0 Vocabulary.</p>
<p>Activity objects linking to external content such as audio, image or video files must include a <code>&quot;hash&quot;</code> field for users to validate linked content.
The value of this <code>&quot;hash&quot;</code> field must be an array of objects representing multiple hashes.
AT LEAST ONE hash in the array MUST be one of the <a href="ActivityContent/Associated/Hash.html#supported-algorithms">supported algorithms</a> although others may also be used.</p>
<table><thead><tr><th>Property</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>algorithm</code></td><td>YES</td><td>The algorithm of the given hash</td><td></td></tr>
<tr><td><code>value</code></td><td>YES</td><td>Hash value serialization</td><td></td></tr>
</tbody></table>
<h3 id="supported-algorithms"><a class="header" href="#supported-algorithms">Supported Algorithms</a></h3>
<table><thead><tr><th>Algorithm</th><th>Description</th><th>Value Serialization</th><th>Specification(s)</th></tr></thead><tbody>
<tr><td><code>keccak256</code></td><td>keccak-256 hash</td><td><a href="ActivityContent/Associated/../../DSNP/Serializations.html#hexadecimal">hexadecimal</a></td><td><a href="https://keccak.team/files/Keccak-submission-3.pdf">The Keccak SHA-3 submission v3</a></td></tr>
</tbody></table>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<pre><code class="language-json">{

  &quot;hash&quot;: [
    {
      &quot;algorithm&quot;: &quot;keccak256&quot;,
      &quot;value&quot;: &quot;0x1234567890ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF&quot;
    },
    {
      &quot;algorithm&quot;: &quot;Ripemd256&quot;,
      &quot;value&quot;: &quot;0x96a9209006748794193d1811ef2dd5f447782b8b1635841165bc031bb3db64da&quot;
    }
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="associated-type-location"><a class="header" href="#associated-type-location">Associated Type: Location</a></h1>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-location">Activity Vocabulary: location</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Place</code></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>YES</td><td>The display name for the location</td><td></td></tr>
<tr><td><code>accuracy</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-accuracy">Activity Vocabulary 2.0</a></td><td>no</td><td>The accuracy of the coordinates as a percentage. (e.g. &quot;94.0&quot; means &quot;94.0% accurate&quot;)</td><td></td></tr>
<tr><td><code>altitude</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-altitude">Activity Vocabulary 2.0</a></td><td>no</td><td>The altitude of the location</td><td></td></tr>
<tr><td><code>latitude</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-latitude">Activity Vocabulary 2.0</a></td><td>no</td><td>The latitude of the location</td><td></td></tr>
<tr><td><code>longitude</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-longitude">Activity Vocabulary 2.0</a></td><td>no</td><td>The longitude of the location</td><td></td></tr>
<tr><td><code>radius</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-radius">Activity Vocabulary 2.0</a></td><td>no</td><td>The area around the given point that comprises the location</td><td></td></tr>
<tr><td><code>units</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-units">Activity Vocabulary 2.0</a></td><td>no</td><td>The units for <code>radius</code> and <code>altitude</code> (defaults to meters)</td><td>MUST be one of: <code>cm</code>, <code>feet</code>, <code>inches</code>, <code>km</code>, <code>m</code>, <code>miles</code></td></tr>
</tbody></table>
<h2 id="warning"><a class="header" href="#warning">Warning</a></h2>
<p>Location data may pose a privacy danger to users.
Users should be warned before publishing location data.</p>
<h2 id="example-3"><a class="header" href="#example-3">Example</a></h2>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;I'm in NYC!&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;location&quot;: {
    &quot;type&quot;: &quot;Place&quot;,
    &quot;name&quot;: &quot;New York City, NY&quot;,
    &quot;latitude&quot;: &quot;40.73&quot;,
    &quot;longitude&quot;: &quot;-73.93&quot;,
    &quot;accuracy&quot;: &quot;94.0&quot;
  },
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="associated-type-tag"><a class="header" href="#associated-type-tag">Associated Type: Tag</a></h1>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-tag">Activity Vocabulary: tag</a></p>
<h2 id="hashtag"><a class="header" href="#hashtag">Hashtag</a></h2>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>YES</td><td>The text of the tag</td><td></td></tr>
</tbody></table>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;I love the #dsnp spec!&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;tag&quot;: [
    {
      &quot;name&quot;: &quot;#dsnp&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<h2 id="mention"><a class="header" href="#mention">Mention</a></h2>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The text of the tag</td><td></td></tr>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the tag as type <code>Mention</code></td><td>MUST be <code>Mention</code></td></tr>
<tr><td><code>id</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-id">Activity Vocabulary 2.0</a></td><td>YES</td><td>Link to the user mentioned</td><td>MUST be a <a href="ActivityContent/Associated/../../DSNP/Identifiers.html#dsnp-user-uri">DSNP User URI</a></td></tr>
</tbody></table>
<h3 id="example-5"><a class="header" href="#example-5">Example</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;@sally should check out the #dsnp spec!&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;tag&quot;: [
    {
      &quot;name&quot;: &quot;#dsnp&quot;
    },
    {
      &quot;name&quot;: &quot;@sally&quot;,
      &quot;type&quot;: &quot;Mention&quot;,
      &quot;id&quot;: &quot;dsnp://0x12345678&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="associated-attachments"><a class="header" href="#associated-attachments">Associated Attachments</a></h1>
<h2 id="audio"><a class="header" href="#audio">Audio</a></h2>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-audio">Activity Vocabulary: Audio</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Audio</code></td></tr>
<tr><td><code>url</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-url">Activity Vocabulary 2.0</a></td><td>YES</td><td>An array of links for given audio content in different formats</td><td>MUST be an <a href="ActivityContent/Associated/Attachments.html#audio-link">Audio Link</a> AND MUST have at least one <a href="ActivityContent/Associated/Attachments.html#supported-audio-mime-types">supported audio MIME type</a></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name for the audio file</td><td></td></tr>
<tr><td><code>duration</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-duration">Activity Vocabulary 2.0</a></td><td>no</td><td>Approximate <a href="https://www.w3.org/TR/xmlschema11-2/#duration">duration</a> of the audio</td><td></td></tr>
</tbody></table>
<h3 id="audio-link"><a class="header" href="#audio-link">Audio Link</a></h3>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Link</code></td></tr>
<tr><td><code>href</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-href">Activity Vocabulary 2.0</a></td><td>YES</td><td>The URL for the given audio content</td><td>MUST be a <a href="ActivityContent/Associated/../Overview.html#supported-url-schema">Supported URL Schema</a></td></tr>
<tr><td><code>mediaType</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-mediatype">Activity Vocabulary 2.0</a></td><td>YES</td><td>MIME type of <code>href</code> content</td><td>MUST follow</td></tr>
<tr><td><code>hash</code></td><td><a href="ActivityContent/Associated/Hash.html">DSNP 1.0</a></td><td>YES</td><td>Array of hashes for linked content validation</td><td>MUST include at least one <a href="ActivityContent/Associated/Hash.html#supported-algorithms">supported hash</a></td></tr>
</tbody></table>
<h3 id="supported-audio-mime-types"><a class="header" href="#supported-audio-mime-types">Supported Audio MIME Types</a></h3>
<table><thead><tr><th>Format</th><th>MIME Type</th><th>Specification(s)</th></tr></thead><tbody>
<tr><td>MP3</td><td><code>audio/mpeg</code></td><td><a href="https://tools.ietf.org/html/rfc3003">RFC3003</a></td></tr>
<tr><td>OGG</td><td><code>audio/ogg</code></td><td><a href="https://tools.ietf.org/html/rfc5334">RFC5334</a></td></tr>
<tr><td>WebM</td><td><code>audio/webm</code></td><td><a href="https://www.webmproject.org/docs/container/">WebM standard</a></td></tr>
</tbody></table>
<h3 id="example-6"><a class="header" href="#example-6">Example</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;attachments&quot;: [
    {
      &quot;type&quot;: &quot;Audio&quot;,
      &quot;name&quot;: &quot;The Scream&quot;,
      &quot;url&quot;: [
        {
          &quot;type&quot;: &quot;Link&quot;,
          &quot;href&quot;: &quot;https://upload.wikimedia.org/wikipedia/commons/d/d9/Wilhelm_Scream.ogg&quot;,
          &quot;mediaType&quot;: &quot;audio/ogg&quot;,
          &quot;hash&quot;: [
            {
              &quot;algorithm&quot;: &quot;keccak256&quot;,
              &quot;value&quot;: &quot;0x3b33df3d163e86514e9041ac97e3d920a75bbafa8d9c1489e631897874b762cc&quot;
            }
          ]
        }
      ],
      &quot;duration&quot;: &quot;1S&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<h2 id="image"><a class="header" href="#image">Image</a></h2>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-image">Activity Vocabulary: Image</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Image</code></td></tr>
<tr><td><code>url</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-url">Activity Vocabulary 2.0</a></td><td>YES</td><td>An array of links for given image content in different formats</td><td>MUST be an <a href="ActivityContent/Associated/Attachments.html#image-link">Image Link</a> AND MUST have at least one <a href="ActivityContent/Associated/Attachments.html#supported-image-mime-types">supported image MIME type</a></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name or alt text for the image</td><td></td></tr>
</tbody></table>
<h3 id="image-link"><a class="header" href="#image-link">Image Link</a></h3>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Link</code></td></tr>
<tr><td><code>href</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-href">Activity Vocabulary 2.0</a></td><td>YES</td><td>The URL for the given image</td><td>MUST be a <a href="ActivityContent/Associated/../Overview.html#supported-url-schema">Supported URL Schema</a></td></tr>
<tr><td><code>mediaType</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-mediatype">Activity Vocabulary 2.0</a></td><td>YES</td><td>MIME type of <code>href</code> content</td><td></td></tr>
<tr><td><code>hash</code></td><td><a href="ActivityContent/Associated/Hash.html">DSNP 1.0</a></td><td>YES</td><td>Array of hashes for linked content validation</td><td>MUST include at least one <a href="ActivityContent/Associated/Hash.html#supported-algorithms">supported hash</a></td></tr>
<tr><td><code>height</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-height">Activity Vocabulary 2.0</a></td><td>no</td><td>A hint as to the rendering height in device-independent pixels</td><td></td></tr>
<tr><td><code>width</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-width">Activity Vocabulary 2.0</a></td><td>no</td><td>A hint as to the rendering width in device-independent pixels</td><td></td></tr>
</tbody></table>
<h3 id="supported-image-mime-types"><a class="header" href="#supported-image-mime-types">Supported Image MIME Types</a></h3>
<table><thead><tr><th>Format</th><th>MIME Type</th><th>Specification(s)</th></tr></thead><tbody>
<tr><td>JPEG</td><td><code>image/jpeg</code></td><td><a href="https://www.iana.org/go/rfc2045">RFC2045</a></td></tr>
<tr><td>PNG</td><td><code>image/png</code></td><td><a href="https://www.w3.org/TR/2003/REC-PNG-20031110/">W3C PNG Standard</a></td></tr>
<tr><td>SVG</td><td><code>image/svg+xml</code></td><td><a href="https://www.w3.org/Graphics/SVG/">W3C SVG standard</a></td></tr>
<tr><td>WebP</td><td><code>image/webp</code></td><td><a href="https://developers.google.com/speed/webp/">WebP standard</a></td></tr>
<tr><td>GIF</td><td><code>image/gif</code></td><td><a href="https://www.iana.org/go/rfc2045">RFC2045</a></td></tr>
</tbody></table>
<h3 id="example-7"><a class="header" href="#example-7">Example</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;attachments&quot;: [
    {
      &quot;type&quot;: &quot;Image&quot;,
      &quot;name&quot;: &quot;One of the founders of DSNP&quot;,
      &quot;url&quot;: [
        {
          &quot;type&quot;: &quot;Link&quot;,
          &quot;href&quot;: &quot;https://upload.wikimedia.org/wikipedia/commons/a/ae/Mccourt.jpg&quot;,
          &quot;width&quot;: 350,
          &quot;height&quot;: 228,
          &quot;mediaType&quot;: &quot;image/jpg&quot;,
          &quot;hash&quot;: [
            {
              &quot;algorithm&quot;: &quot;keccak256&quot;,
              &quot;value&quot;: &quot;0x90b3b09658ec527d679c2de983b5720f6e12670724f7e227e5c360a3510b4cb5&quot;
            }
          ]
        }
      ]
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<h2 id="video"><a class="header" href="#video">Video</a></h2>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-video">Activity Vocabulary: Video</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Video</code></td></tr>
<tr><td><code>url</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-url">Activity Vocabulary 2.0</a></td><td>YES</td><td>An array of links for given video content in different formats</td><td>MUST be a <a href="ActivityContent/Associated/Attachments.html#video-link">Video Link</a> AND MUST have at least one <a href="ActivityContent/Associated/Attachments.html#supported-video-mime-types">supported video MIME type</a></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name for the video</td><td></td></tr>
<tr><td><code>duration</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-duration">Activity Vocabulary 2.0</a></td><td>no</td><td>Approximate <a href="https://www.w3.org/TR/xmlschema11-2/#duration">duration</a> of the video</td><td></td></tr>
</tbody></table>
<h3 id="video-link"><a class="header" href="#video-link">Video Link</a></h3>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Link</code></td></tr>
<tr><td><code>href</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-href">Activity Vocabulary 2.0</a></td><td>YES</td><td>The URL for the given content</td><td>MUST be a <a href="ActivityContent/Associated/../Overview.html#supported-url-schema">Supported URL Schema</a></td></tr>
<tr><td><code>mediaType</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-mediatype">Activity Vocabulary 2.0</a></td><td>YES</td><td>MIME type of <code>href</code> content</td><td></td></tr>
<tr><td><code>hash</code></td><td><a href="ActivityContent/Associated/Hash.html">DSNP 1.0</a></td><td>YES</td><td>Array of hashes for linked content validation</td><td>MUST include at least one <a href="ActivityContent/Associated/Hash.html#supported-algorithms">supported hash</a></td></tr>
<tr><td><code>height</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-height">Activity Vocabulary 2.0</a></td><td>no</td><td>A hint as to the rendering height in device-independent pixels</td><td></td></tr>
<tr><td><code>width</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-width">Activity Vocabulary 2.0</a></td><td>no</td><td>A hint as to the rendering width in device-independent pixels</td><td></td></tr>
</tbody></table>
<h3 id="supported-video-mime-types"><a class="header" href="#supported-video-mime-types">Supported Video MIME Types</a></h3>
<table><thead><tr><th>Format</th><th>MIME Type</th><th>Specification(s)</th></tr></thead><tbody>
<tr><td>MPEG</td><td><code>video/mpeg</code></td><td><a href="https://www.iana.org/go/rfc2045">RFC2045</a></td></tr>
<tr><td>OGG</td><td><code>video/ogg</code></td><td><a href="https://www.iana.org/go/rfc5334">RFC5334</a></td></tr>
<tr><td>WebM</td><td><code>video/webm</code></td><td><a href="https://www.webmproject.org/docs/container/">WebM standard</a></td></tr>
<tr><td>H265</td><td><code>video/H265</code></td><td><a href="https://www.iana.org/go/rfc7798">RFC7798</a></td></tr>
<tr><td>MP4</td><td><code>video/mp4</code></td><td><a href="https://www.iana.org/go/rfc4337">RFC4337</a></td></tr>
</tbody></table>
<h3 id="example-8"><a class="header" href="#example-8">Example</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;attachments&quot;: [
    {
      &quot;type&quot;: &quot;Video&quot;,
      &quot;name&quot;: &quot;One of the founders of DSNP&quot;,
      &quot;duration&quot;: &quot;PT10M32S&quot;,
      &quot;url&quot;: [
        {
          &quot;type&quot;: &quot;Link&quot;,
          &quot;href&quot;: &quot;https://upload.wikimedia.org/wikipedia/commons/c/c0/Big_Buck_Bunny_4K.webm&quot;,
          &quot;width&quot;: 4000,
          &quot;height&quot;: 2250,
          &quot;mediaType&quot;: &quot;video/webm&quot;,
          &quot;hash&quot;: [
            {
              &quot;algorithm&quot;: &quot;keccak256&quot;,
              &quot;value&quot;: &quot;0xf841950dfcedc968dbd63132da844b9f28faea3dbfd4cf326b3831b419a20e9a&quot;
            }
          ]
        }
      ]
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<h2 id="link"><a class="header" href="#link">Link</a></h2>
<p><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-link">Activity Vocabulary: Link</a></p>
<table><thead><tr><th>Property</th><th>Base Spec</th><th>Required</th><th>Description</th><th>Restrictions</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-type">Activity Vocabulary 2.0</a></td><td>YES</td><td>Identifies the type of the object</td><td>MUST be set to <code>Link</code></td></tr>
<tr><td><code>href</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-href">Activity Vocabulary 2.0</a></td><td>YES</td><td>The URL for the given link</td><td>MUST be a <a href="ActivityContent/Associated/../Overview.html#supported-url-schema">Supported URL Schema</a></td></tr>
<tr><td><code>name</code></td><td><a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-name">Activity Vocabulary 2.0</a></td><td>no</td><td>The display name for the link</td><td></td></tr>
</tbody></table>
<h3 id="examples-3"><a class="header" href="#examples-3">Examples</a></h3>
<pre><code class="language-json">{
  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
  &quot;type&quot;: &quot;Note&quot;,
  &quot;content&quot;: &quot;Check out the DSNP Website!&quot;,
  &quot;mediaType&quot;: &quot;text/plain&quot;,
  &quot;attachment&quot;: [
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;name&quot;: &quot;DSNP Website&quot;,
      &quot;href&quot;: &quot;https://dsnp.org&quot;
    }
  ],
  &quot;published&quot;: &quot;1970-01-01T00:00:00+00:00&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<ul>
<li><strong>Activity Content</strong> - The linked content connected to an &quot;Announcement&quot;</li>
<li><strong>Announcement</strong> - An item of data, typically an image or note, posted to the blockchain via a &quot;Batch Publication&quot;</li>
<li><strong>Bad actor</strong> - A user intentionally using the application for bad-faith or illegal purposes</li>
<li><strong>Batch Publication</strong> - A collection of Announcements</li>
<li><strong>Bot</strong> - An automated account, sometimes malicious but often providing some service (&quot;Hey Alexa, what's the weather?&quot;)</li>
<li><strong>Consumer</strong> - Someone who reads content from social media</li>
<li><strong>Contract address</strong> - The unique number associated with a smart contract posted on the blockchain</li>
<li><strong>Hash Collision</strong> - The vanishingly unlikely possibility of a hash providing the same output for two different inputs</li>
<li><strong>Hash function</strong> - A cryptographic function whose output is effectively unique for any given input without any information from the input being accessible in the output</li>
<li><strong>Hash</strong> - A string of characters generated from a hash function, see &quot;Hash function&quot;</li>
<li><strong>Identity Contract</strong> - The smart contract used to store a user's delegated public addresses and permissions, see &quot;Contract address&quot;</li>
<li><strong>Publisher</strong> - The contract that posts new content from a publisher to the blockchain through batch publications</li>
<li><strong>Store</strong> - A means of keeping messages or data for an extended period of time</li>
<li><strong>User</strong> - A human using our application. <a href="https://time.com/4008832/17-dogs-to-follow-on-instagram/">See article for an exception</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="draft-archivists-overview"><a class="header" href="#draft-archivists-overview">DRAFT: Archivists Overview</a></h1>
<p>The job of an Archivist is to permanently store Batch content and DSNP Announcements in a format that is easily validated and retrieved.</p>
<p>The Archivist must be able to access chain data and all DSNP Content.</p>
<h2 id="validations-that-archivists-could-perform"><a class="header" href="#validations-that-archivists-could-perform">Validations that Archivists could perform</a></h2>
<ul>
<li>Signature validation - proof that author provided a real signature</li>
<li>Signature authentication - proof that the From address is the signer, or that signer is a valid delegate  (proof of authorship)</li>
<li>There is retrievable content at the URL given in the DSNP message</li>
<li>The content hash is valid - that is, the URL serves the claimed data</li>
</ul>
<p>All signatures for the announcement are included in the batch regardless of how the signature was requested (or not)</p>
<h1 id="archive-storage-format"><a class="header" href="#archive-storage-format">Archive Storage Format</a></h1>
<p>Specify the off-chain Archivist <em>storage</em> format.</p>
<h2 id="assumptions-2"><a class="header" href="#assumptions-2">Assumptions</a></h2>
<ul>
<li>Chain messages are on Ethereum.</li>
<li>Message data is posted via <a href="https://medium.com/mycrypto/understanding-event-logs-on-the-ethereum-blockchain-f4ae7ba50378">Ethereum log events</a>.</li>
<li>Signature algorithm is <a href="https://en.bitcoin.it/wiki/Secp256k1">secp256k1</a>. This allows the use <code>ecreover</code> to get public keys. A public key also need not be included in a log event for ease of validation.</li>
<li>Content hashes are created via the same <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hashing algorithm</a> used by Ethereum.</li>
</ul>
<h2 id="archive-entry"><a class="header" href="#archive-entry">Archive Entry</a></h2>
<p>An archive entry is a combination of data in a DSNP message and from the block in which it is included.
It is a key-value map consisting of the following fields:</p>
<table><thead><tr><th>field name</th><th>description</th><th>type</th></tr></thead><tbody>
<tr><td><code>dsnpType</code></td><td>DSNP message type</td><td>number/enum. see <a href="Draft/../DSNP/Announcements.html#announcement-types">DSNP Message Types</a></td></tr>
<tr><td><code>dsnpData</code></td><td>DSNP message data</td><td>see fields in <a href="Draft/../DSNP/Announcements.html">DSNP Messages</a></td></tr>
<tr><td><code>signatures</code></td><td>list of signatures for this message</td><td>array of Signatures</td></tr>
</tbody></table>
<h3 id="dsnptype"><a class="header" href="#dsnptype"><code>dsnpType</code></a></h3>
<ul>
<li>number</li>
<li>Indicates what type of message this is, useful for indexers and filters.</li>
</ul>
<h3 id="dsnpdata"><a class="header" href="#dsnpdata"><code>dsnpData</code></a></h3>
<ul>
<li>varies</li>
<li>This can be encrypted where appropriate. The decrypted, fully deserialized version must be one of the types described in <a href="Draft/../DSNP/Announcements.html">DSNP Messages</a>.</li>
</ul>
<h3 id="signatures"><a class="header" href="#signatures"><code>signatures</code></a></h3>
<ul>
<li>array</li>
<li>all the signatures applied to this message at the time of archival.</li>
</ul>
<h2 id="batch"><a class="header" href="#batch">Batch</a></h2>
<p>A <em>Batch</em> is data that is referenced by a Batch Announcement.
It consists of one or more ArchiveEntries.</p>
<table><thead><tr><th>field</th><th>description</th><th>type</th></tr></thead><tbody>
<tr><td><code>archives</code></td><td>a set of ArchiveEntries</td><td>map<code>[ArchiveEntry]</code></td></tr>
<tr><td><code>batchID</code></td><td>keccak-256 hash of content stored at URL</td><td>bytes32</td></tr>
<tr><td><code>blockHeight</code></td><td>the block number this message was included in</td><td>number</td></tr>
<tr><td><code>fromAddress</code></td><td>social identity of batch announcer,i.e. message sender</td><td>bytes</td></tr>
<tr><td><code>logIndex</code></td><td>the index within the logs of this message</td><td>number</td></tr>
<tr><td><code>signature</code></td><td>announcer's signature</td><td>Signature</td></tr>
<tr><td><code>transactionIndex</code></td><td>the index of the transaction this message is associated with</td><td>number</td></tr>
<tr><td><code>url</code></td><td>the location of this archive</td><td>string</td></tr>
</tbody></table>
<h3 id="archives"><a class="header" href="#archives"><code>archives</code></a></h3>
<p>The set of ArchiveEntries is a key-value map, with the key
being the <code>archiveEntryID</code>, which is a:</p>
<ul>
<li>bytes32</li>
<li>The keccak-256 hash of all of the Archive Entry fields in a keccak-256 hash with the archiveEntryID field being blank.</li>
</ul>
<h3 id="batchid"><a class="header" href="#batchid"><code>batchID</code></a></h3>
<ul>
<li>bytes32</li>
<li>the keccak-256 hash of content stored at the URL referenced in this batch.</li>
</ul>
<h3 id="blockheight"><a class="header" href="#blockheight"><code>blockHeight</code></a></h3>
<ul>
<li>number</li>
<li>The block in which this DSNP Message is included.</li>
</ul>
<h3 id="fromaddress"><a class="header" href="#fromaddress"><code>fromAddress</code></a></h3>
<p>the social identity of the batch announcer, i.e. the message sender.</p>
<h3 id="logindex"><a class="header" href="#logindex"><code>logIndex</code></a></h3>
<ul>
<li>number</li>
<li>The log index in which this DSNP Message is included</li>
</ul>
<h3 id="signature"><a class="header" href="#signature"><code>signature</code></a></h3>
<ul>
<li><a href="Draft/Archivists.html#Signature">Signature</a> (see below)</li>
<li>The signature of this batch announcer</li>
</ul>
<h3 id="transactionindex"><a class="header" href="#transactionindex"><code>transactionIndex</code></a></h3>
<ul>
<li>number</li>
<li>The transaction index in which this DSNP Message is included</li>
</ul>
<h3 id="url-4"><a class="header" href="#url-4"><code>url</code></a></h3>
<ul>
<li>string</li>
<li>The permanent URL address where this archive is stored.</li>
</ul>
<h2 id="signature-1"><a class="header" href="#signature-1">Signature</a></h2>
<p>A Signature consists of two fields:</p>
<ul>
<li><code>signature</code> - A <a href="https://en.bitcoin.it/wiki/Secp256k1">secp256k1</a> signature</li>
<li><code>result</code> - Optional, bytes. A result of an operation performed. For example, if a signing entity wished to prove that they had performed some sort of validation or analysis on the message, they would put the result of the analysis in this field. It could be a meaningful number or string, some sort of proof hash, etc.</li>
</ul>
<h2 id="diagram"><a class="header" href="#diagram">Diagram</a></h2>
<p><img src="https://github.com/LibertyDSNP/spec/blob/c9f55041950e7f54ce07d0f32de6b35d4fa4e7c0/images/ArchiveMessages.png?raw=true" alt="Archive Messages Diagram" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
