<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Archivists - DSNP Specification</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 800) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <a id="logo" href="https://www.dsnp.org/">
                    DSNP
                </a>
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Introduction</a></li><li class="chapter-item affix "><a href="../Roadmap.html">Roadmap</a></li><li class="chapter-item "><a href="../DSNP/Overview.html">DSNP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../DSNP/Identity.html">Identity</a></li><li class="chapter-item "><a href="../DSNP/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="../DSNP/Graph.html">Graph</a></li><li class="chapter-item "><a href="../DSNP/BatchPublications.html">Batch Publications</a></li><li class="chapter-item "><a href="../DSNP/Announcements.html">Announcements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../DSNP/Types/Tombstone.html">Tombstone</a></li><li class="chapter-item "><a href="../DSNP/Types/GraphChange.html">Graph Change</a></li><li class="chapter-item "><a href="../DSNP/Types/Broadcast.html">Broadcast</a></li><li class="chapter-item "><a href="../DSNP/Types/Reply.html">Reply</a></li><li class="chapter-item "><a href="../DSNP/Types/Reaction.html">Reaction</a></li><li class="chapter-item "><a href="../DSNP/Types/Profile.html">Profile</a></li><li class="chapter-item "><a href="../DSNP/Types/Update.html">Update</a></li></ol></li><li class="chapter-item "><a href="../DSNP/Operations.html">Operations</a></li><li class="chapter-item "><a href="../DSNP/Records.html">State Change Records</a></li><li class="chapter-item "><a href="../DSNP/Serializations.html">Serializations</a></li></ol></li><li class="chapter-item "><a href="../Implementations.html">DSNP Implementation Specs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Overview.html">Frequency</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Identity.html">Identity</a></li><li class="chapter-item "><a href="../Frequency/Publishing.html">Publishing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Validation.html">Validation</a></li></ol></li></ol></li><li class="chapter-item "><a href="../Ethereum/Overview.html">EVM (Deprecated)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Ethereum/Identity.html">Identity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Ethereum/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="../Ethereum/IdentityFactory.html">Factory</a></li><li class="chapter-item "><a href="../Ethereum/Registry.html">Registry</a></li></ol></li><li class="chapter-item "><a href="../Ethereum/Publishing.html">Publishing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Ethereum/Validation.html">Validation</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../ActivityContent/Overview.html">Activity Content</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ActivityContent/Types/Note.html">Note</a></li><li class="chapter-item "><a href="../ActivityContent/Types/Profile.html">Profile</a></li><li class="chapter-item "><div>Associated Type</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ActivityContent/Associated/Hash.html">Hash</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Location.html">Location</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Tag.html">Tag</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Attachments.html">Attachments</a></li></ol></li></ol></li><li class="chapter-item "><a href="../Reference/Glossary.html">Glossary</a></li><li class="chapter-item expanded "><div>Draft Specifications</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Draft/Archivists.html" class="active">Archivists</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DSNP Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LibertyDSNP/spec" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/LibertyDSNP/spec/blob/main/pages/Draft/Archivists.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Type to search..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="draft-archivists-overview"><a class="header" href="#draft-archivists-overview">DRAFT: Archivists Overview</a></h1>
<p>The job of an Archivist is to permanently store Batch content and DSNP Announcements in a format that is easily validated and retrieved.</p>
<p>The Archivist must be able to access chain data and all DSNP Content.</p>
<h2 id="validations-that-archivists-could-perform"><a class="header" href="#validations-that-archivists-could-perform">Validations that Archivists could perform</a></h2>
<ul>
<li>Signature validation - proof that author provided a real signature</li>
<li>Signature authentication - proof that the From address is the signer, or that signer is a valid delegate  (proof of authorship)</li>
<li>Content authentication - retrievable content is at the URL given in the DSNP message</li>
<li>Content Hash authentication - content hash is valid and the URL serves the claimed data</li>
</ul>
<p>All signatures for the announcement are included in the batch regardless of how the signature was/was not requested.</p>
<h1 id="archive-storage-format"><a class="header" href="#archive-storage-format">Archive Storage Format</a></h1>
<p>Specify the off-chain Archivist <em>storage</em> format.</p>
<h2 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h2>
<ul>
<li>Chain messages are on Ethereum.</li>
<li>Message data is posted via <a href="https://medium.com/mycrypto/understanding-event-logs-on-the-ethereum-blockchain-f4ae7ba50378">Ethereum log events</a>.</li>
<li>Signature algorithm is <a href="https://en.bitcoin.it/wiki/Secp256k1">secp256k1</a>. This allows the use <code>ecreover</code> to get public keys. A public key also need not be included in a log event for ease of validation.</li>
<li>Content hashes are created via the same <a href="https://keccak.team/files/Keccak-submission-3.pdf">keccak-256 hashing algorithm</a> used by Ethereum.</li>
</ul>
<h2 id="archive-entry"><a class="header" href="#archive-entry">Archive Entry</a></h2>
<p>An archive entry is a combination of data in a DSNP message and from the block in which it is included.
It is a key-value map consisting of the following fields:</p>
<div class="table-wrapper"><table><thead><tr><th>field name</th><th>description</th><th>type</th></tr></thead><tbody>
<tr><td><code>dsnpType</code></td><td>DSNP message type</td><td>number/enum. see <a href="../DSNP/Announcements.html#announcement-types">DSNP Message Types</a></td></tr>
<tr><td><code>dsnpData</code></td><td>DSNP message data</td><td>see fields in <a href="../DSNP/Announcements.html">DSNP Messages</a></td></tr>
<tr><td><code>signatures</code></td><td>list of signatures for this message</td><td>array of Signatures</td></tr>
</tbody></table>
</div>
<h3 id="dsnptype"><a class="header" href="#dsnptype"><code>dsnpType</code></a></h3>
<ul>
<li>number</li>
<li>Indicates what type of message this is, useful for indexers and filters.</li>
</ul>
<h3 id="dsnpdata"><a class="header" href="#dsnpdata"><code>dsnpData</code></a></h3>
<ul>
<li>varies</li>
<li>This can be encrypted where appropriate. The decrypted, fully deserialized version must be one of the types described in <a href="../DSNP/Announcements.html">DSNP Messages</a>.</li>
</ul>
<h3 id="signatures"><a class="header" href="#signatures"><code>signatures</code></a></h3>
<ul>
<li>array</li>
<li>all signatures applied to this message at the time of archival</li>
</ul>
<h2 id="batch"><a class="header" href="#batch">Batch</a></h2>
<p>A <em>Batch</em> is data that is referenced by a Batch Announcement.
It consists of one or more <code>ArchiveEntries</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>field</th><th>description</th><th>type</th></tr></thead><tbody>
<tr><td><code>archives</code></td><td>a set of <code>ArchiveEntries</code></td><td>map<code>[ArchiveEntry]</code></td></tr>
<tr><td><code>batchId</code></td><td>keccak-256 hash of content stored at URL</td><td>bytes32</td></tr>
<tr><td><code>blockHeight</code></td><td>the block number this message was included in</td><td>number</td></tr>
<tr><td><code>fromAddress</code></td><td>social identity of batch announcer, i.e. message sender</td><td>bytes</td></tr>
<tr><td><code>logIndex</code></td><td>the index within the logs of this message</td><td>number</td></tr>
<tr><td><code>signature</code></td><td>announcer's signature</td><td>Signature</td></tr>
<tr><td><code>transactionIndex</code></td><td>the index of the transaction this message is associated with</td><td>number</td></tr>
<tr><td><code>url</code></td><td>the location of this archive</td><td>string</td></tr>
</tbody></table>
</div>
<h3 id="archives"><a class="header" href="#archives"><code>archives</code></a></h3>
<p>The set of <code>ArchiveEntries</code> is a key-value map, with the key
being the <code>archiveEntryId</code>:</p>
<ul>
<li>bytes32</li>
<li>the keccak-256 hash of all of the Archive Entry fields in a keccak-256 hash with the <code>archiveEntryId</code> field being blank</li>
</ul>
<h3 id="batchid"><a class="header" href="#batchid"><code>batchId</code></a></h3>
<ul>
<li>bytes32</li>
<li>the keccak-256 hash of content stored at the URL referenced in this batch</li>
</ul>
<h3 id="blockheight"><a class="header" href="#blockheight"><code>blockHeight</code></a></h3>
<ul>
<li>number</li>
<li>the block in which this DSNP Message is included</li>
</ul>
<h3 id="fromaddress"><a class="header" href="#fromaddress"><code>fromAddress</code></a></h3>
<p>the social identity of the batch announcer, i.e. the message sender.</p>
<h3 id="logindex"><a class="header" href="#logindex"><code>logIndex</code></a></h3>
<ul>
<li>number</li>
<li>The log index in which this DSNP Message is included</li>
</ul>
<h3 id="signature"><a class="header" href="#signature"><code>signature</code></a></h3>
<ul>
<li><a href="#Signature">Signature</a> (see below)</li>
<li>the signature of this batch announcer</li>
</ul>
<h3 id="transactionindex"><a class="header" href="#transactionindex"><code>transactionIndex</code></a></h3>
<ul>
<li>number</li>
<li>the transaction index in which this DSNP Message is included</li>
</ul>
<h3 id="url"><a class="header" href="#url"><code>url</code></a></h3>
<ul>
<li>string</li>
<li>the permanent URL address where this archive is stored</li>
</ul>
<h2 id="signature-1"><a class="header" href="#signature-1">Signature</a></h2>
<p>A Signature consists of two fields:</p>
<ul>
<li><code>signature</code> - A <a href="https://en.bitcoin.it/wiki/Secp256k1">secp256k1</a> signature</li>
<li><code>result</code> - Optional, bytes - a result of an operation performed. For example, if a signing entity wished to prove that they had performed some sort of validation or analysis on the message, they would put the result of the analysis in this field. It could be a meaningful number or string, some sort of proof hash, etc.</li>
</ul>
<h2 id="diagram"><a class="header" href="#diagram">Diagram</a></h2>
<p><img src="https://github.com/LibertyDSNP/spec/blob/c9f55041950e7f54ce07d0f32de6b35d4fa4e7c0/images/ArchiveMessages.png?raw=true" alt="Archive Messages Diagram" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Reference/Glossary.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Reference/Glossary.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
