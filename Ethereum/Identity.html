<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Identity - DSNP Specification</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 800) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <a id="logo" href="https://www.dsnp.org/">
                    DSNP
                </a>
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Introduction</a></li><li class="chapter-item affix "><a href="../Roadmap.html">Roadmap</a></li><li class="chapter-item "><a href="../DSNP/Overview.html">DSNP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../DSNP/Identity.html">Identity</a></li><li class="chapter-item "><a href="../DSNP/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="../DSNP/Graph.html">Graph</a></li><li class="chapter-item "><a href="../DSNP/BatchPublications.html">Batch Publications</a></li><li class="chapter-item "><a href="../DSNP/Announcements.html">Announcements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../DSNP/Types/Tombstone.html">Tombstone</a></li><li class="chapter-item "><a href="../DSNP/Types/GraphChange.html">Graph Change</a></li><li class="chapter-item "><a href="../DSNP/Types/Broadcast.html">Broadcast</a></li><li class="chapter-item "><a href="../DSNP/Types/Reply.html">Reply</a></li><li class="chapter-item "><a href="../DSNP/Types/Reaction.html">Reaction</a></li><li class="chapter-item "><a href="../DSNP/Types/Profile.html">Profile</a></li><li class="chapter-item "><a href="../DSNP/Types/Update.html">Update</a></li></ol></li><li class="chapter-item "><a href="../DSNP/Serializations.html">Serializations</a></li></ol></li><li class="chapter-item expanded "><a href="../Implementations.html">DSNP Implementation Specs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Overview.html">Frequency</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Identity.html">Identity</a></li><li class="chapter-item "><a href="../Frequency/Publishing.html">Publishing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Frequency/Validation.html">Validation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../Ethereum/Overview.html">EVM (Deprecated)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Ethereum/Identity.html" class="active">Identity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Ethereum/Identifiers.html">Identifiers</a></li><li class="chapter-item "><a href="../Ethereum/IdentityFactory.html">Factory</a></li><li class="chapter-item "><a href="../Ethereum/Registry.html">Registry</a></li></ol></li><li class="chapter-item "><a href="../Ethereum/Publishing.html">Publishing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Ethereum/Validation.html">Validation</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../ActivityContent/Overview.html">Activity Content</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ActivityContent/Types/Note.html">Note</a></li><li class="chapter-item "><a href="../ActivityContent/Types/Profile.html">Profile</a></li><li class="chapter-item "><div>Associated Type</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ActivityContent/Associated/Hash.html">Hash</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Location.html">Location</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Tag.html">Tag</a></li><li class="chapter-item "><a href="../ActivityContent/Associated/Attachments.html">Attachments</a></li></ol></li></ol></li><li class="chapter-item "><a href="../Reference/Glossary.html">Glossary</a></li><li class="chapter-item "><div>Draft Specifications</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../Draft/Archivists.html">Archivists</a></li></ol></li></ol>
                <div class="spacer"></div>
                <a href="https://www.dsnp.org/developer-portal/" class="nav-return">↩ Developer Portal</a>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DSNP Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LibertyDSNP/spec" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/LibertyDSNP/spec/blob/main/pages/Ethereum/Identity.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Type to search..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="identity"><a class="header" href="#identity">Identity</a></h1>
<h2 id="purpose"><a class="header" href="#purpose">Purpose</a></h2>
<ol>
<li>Provide the interface for a DSNP identity.</li>
<li>Specify the delegation model and related interface.</li>
<li>Specify the ownership model and related interface.</li>
<li>Provide the list of EIPs that must be supported by a DSNP-compatible identity.</li>
</ol>
<h2 id="details"><a class="header" href="#details">Details</a></h2>
<h2 id="ownership"><a class="header" href="#ownership">Ownership</a></h2>
<p>Ownership of an identity on Ethereum is determined by the address of the signer of the content.</p>
<p>Creation of any new identity MUST be authorized by the owner's address.
The official <a href="IdentityFactory.html">Identity Factory</a> is provided for initial creation of a new identity.</p>
<p>Creation of an identity on behalf of someone is described in the <a href="IdentityFactory.html">Identity Factory</a>.</p>
<h3 id="permissioned-owners"><a class="header" href="#permissioned-owners">Permissioned Owners</a></h3>
<p>Ownership is managed through using permissions.
While at least one owner is required, additional public keys may be considered to have ownership and may remove or add other owners.</p>
<h2 id="delegation"><a class="header" href="#delegation">Delegation</a></h2>
<p>Delegation allows adding additional public keys, in addition to the owner public key(s).
These delegated keys are allowed to perform certain actions on behalf of the owner based on the delegate's &quot;role&quot;.</p>
<h3 id="interface"><a class="header" href="#interface">Interface</a></h3>
<pre><code class="language-solidity">/**
 * @dev DSNP Identity Interface for managing delegates
 */
interface IDelegation {

    struct DelegateAdd {
        uint32 nonce;
        address delegateAddr;
        Role role;
    }

    struct DelegateRemove {
        uint32 nonce;
        address delegateAddr;
    }

    /**
     * @dev Enumerated Permissions
     *      Roles have different permissions
     *      APPEND ONLY
     */
    enum Permission {
        /**
         * @dev 0x0 NONE reserved for no permissions
         */
        NONE,
        /**
         * @dev 0x1 Announce any DSNP message
         */
        ANNOUNCE,
        /**
         * @dev 0x2 Add new delegate
         */
        OWNERSHIP_TRANSFER,
        /**
         * @dev 0x3 Add new delegates
         */
        DELEGATE_ADD,
        /**
         * @dev 0x4 Remove delegates
         */
        DELEGATE_REMOVE
    }

    /**
     * @dev Enumerated Roles
     *      Roles have different permissions
     *      APPEND ONLY
     */
    enum Role {
        /**
         * @dev 0x0 NONE reserved for no permissions
         */
        NONE,
        /**
         * @dev 0x1 OWNER:
         *      - Permission.*
         */
        OWNER,
        /**
         * @dev 0x2 ANNOUNCER:
         *      - Permission.ANNOUNCE
         */
        ANNOUNCER
    }

    /**
     * @dev Log for addition of a new delegate
     * @param delegate Address delegated
     * @param role Permission Role
     */
    event DSNPAddDelegate(address delegate, Role role);

    /**
     * @dev Log for removal of a delegate
     * @param delegate Address revoked
     */
    event DSNPRemoveDelegate(address delegate);

    /**
     * @dev Add or change permissions for delegate
     * @param newDelegate Address to delegate new permissions to
     * @param role Role for the delegate
     *
     * MUST be called by owner or other delegate with permissions
     * MUST consider newDelegate to be valid from the beginning to time
     * MUST emit DSNPAddDelegate
     */
    function delegate(address newDelegate, Role role) external;

    /**
     * @dev Add or change permissions for delegate by EIP-712 signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing new delegate address, role, and nonce
     *
     * MUST be signed by owner or other delegate with permissions (implementation specific)
     * MUST consider newDelegate to be valid from the beginning to time
     * MUST emit DSNPAddDelegate
     */
    function delegateByEIP712Sig(
        uint8 v,
        bytes32 r,
        bytes32 s,
        DelegateAdd calldata change
    ) external;

    /**
     * @dev Remove Delegate
     * @param addr Address to remove all permissions from
     *
     * MUST be called by the delegate, owner, or other delegate with permissions
     * MUST store the block.number as the endBlock for response in isAuthorizedToAnnounce (exclusive)
     *
     * MUST emit DSNPRemoveDelegate
     */
    function delegateRemove(address addr) external;

    /**
     * @dev Remove Delegate By EIP-712 Signature
     * @param v EIP-155 calculated Signature v value
     * @param r ECDSA Signature r value
     * @param s ECDSA Signature s value
     * @param change Change data containing new delegate address and nonce
     *
     * MUST be signed by the delegate, owner, or other delegate with permissions
     * MUST store the block.number as the endBlock for response in isAuthorizedToAnnounce (exclusive)
     * MUST emit DSNPRemoveDelegate
     */
    function delegateRemoveByEIP712Sig(
        uint8 v,
        bytes32 r,
        bytes32 s,
        DelegateRemove calldata change
    ) external;

    /**
     * @dev Checks to see if address is authorized with the given permission
     * @param addr Address that is used to test
     * @param permission Level of permission check. See Permission for details
     * @param blockNumber Check for authorization at a particular block number, 0x0 reserved for endless permissions
     * @return boolean
     *
     * @dev Immutable assuming operating on confirmed blocks
     */
    function isAuthorizedTo(
        address addr,
        Permission permission,
        uint256 blockNumber
    ) external view returns (bool);

    /**
     * @dev Get a delegate's nonce
     * @param addr The delegate's address to get the nonce for
     *
     * @return nonce value for delegate
     */
    function getNonceForDelegate(address addr) external view returns (uint32);
}
</code></pre>
<h2 id="upgrade-interface"><a class="header" href="#upgrade-interface">Upgrade Interface</a></h2>
<p>It is an open question if we want to require a standard set of upgrade interfaces.</p>
<h2 id="additional-required-interfaces"><a class="header" href="#additional-required-interfaces">Additional Required Interfaces</a></h2>
<h3 id="eip-165"><a class="header" href="#eip-165">EIP 165</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-165">EIP 165</a> provides standard interface detection.
It is required to support optional interfaces and upgrade expansion.</p>
<h2 id="additional-optional-interfaces"><a class="header" href="#additional-optional-interfaces">Additional Optional Interfaces</a></h2>
<h3 id="eip-173"><a class="header" href="#eip-173">EIP 173</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-173">EIP 173</a> provides methods that confirm ownership and provide methods to transfer ownership.
Implementations that choose to use this interface will need to consider that transferring ownership should revoke all existing delegations, or at a minimum all delegates at <code>Role.OWNER</code>.</p>
<h3 id="eip-897"><a class="header" href="#eip-897">EIP 897</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-897">EIP 897</a> is for DSNP identity contracts
that are proxies such as those produced by the default <a href="IdentityFactory.html">Identity Factory</a>.</p>
<h3 id="eip-1271"><a class="header" href="#eip-1271">EIP 1271</a></h3>
<p><a href="https://eips.ethereum.org/EIPS/eip-1271">EIP 1271</a> allows the identity contract to validate a signature.
To support delegation, this interface allows a contract to validate against the signature of the owner.</p>
<p>Unlike <code>IDelegation.isAuthorizedToAnnounce</code> which supports permission levels and end block number, <code>isValidSignature</code> will only respond to currently permissioned addresses at the owner level.</p>
<p><strong>REMEMBER</strong>: Implementation <em>MUST ONLY</em> return true for active owner level.</p>
<h3 id="identity-requirements"><a class="header" href="#identity-requirements">Identity Requirements</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Interface</th><th>Required</th></tr></thead><tbody>
<tr><td>IDelegation</td><td>Required</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-165">EIP 165</a></td><td>Required</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-897">EIP 897</a></td><td>Proxy Contracts Only</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-173">EIP 173</a></td><td>Optional</td></tr>
<tr><td><a href="https://eips.ethereum.org/EIPS/eip-1271">EIP 1271</a></td><td>Optional</td></tr>
</tbody></table>
</div>
<h2 id="rejected-solutions"><a class="header" href="#rejected-solutions">Rejected Solutions</a></h2>
<ul>
<li>Centralized smart contract maintaining identifiers and owners
<ul>
<li>Top Rejection Reasons:
<ul>
<li>A centralized contract must either be controlled by the foundation, a DAO, or non-upgradable</li>
<li>Does not allow for complete flexibility in ownership</li>
</ul>
</li>
</ul>
</li>
<li>Using a single public key as an identifier
<ul>
<li>Top Rejection Reasons:
<ul>
<li>Does not allow for flexibility in ownership</li>
<li>Completely dependent on off-chain software and processing for verification of delegation</li>
</ul>
</li>
</ul>
</li>
<li>Using a single owner model
<ul>
<li>A single owner (as well as the existing EIP 173 to manage it) was considered as opposed to the multi-owner role system</li>
<li>Top Rejection Reasons:
<ul>
<li>Does not allow for flexibility in ownership</li>
<li>Single-owner increases the likelihood of users using choosing less secure key management practices</li>
<li>Multi-owner pairs better with a permissioned system</li>
</ul>
</li>
</ul>
</li>
<li>Using a simple two-tier permission model
<ul>
<li>Owner level and &quot;everything&quot; else</li>
<li>Top Rejection Reasons:
<ul>
<li>Limits options for future specific roles such as social recovery</li>
<li>Cost savings were minimal when paired with a role based system</li>
</ul>
</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Ethereum/Overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../Ethereum/Identifiers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Ethereum/Overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../Ethereum/Identifiers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
